<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codefusion - Advanced Code Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* General Styles */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: #ecf0f1;
            min-height: 100vh;
            overflow: hidden;
            transition: background 0.5s ease-in-out;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin-top: 40px;
            text-align: center;
            animation: fadeIn 1.5s ease-in-out;
            position: relative;
            display: none;
            /* Hidden initially */
        }

        h1 {
            font-size: 3rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: #ecf0f1;
            animation: slideIn 1s ease-out;
            margin-bottom: 30px;
        }

        /* Loading Screen Styles */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #loading-screen h2 {
            color: #ecf0f1;
            font-size: 2em;
            margin-bottom: 20px
        }

        #loading-bar-container {
            width: 50%;
            height: 10px;
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
        }

        #loading-bar {
            height: 100%;
            background-color: #ff6347;
            width: 0;
            transition: width 0.1s linear;
        }

        /*Header buttons*/
        #header-buttons {
            display: flex;
            justify-content: flex-end;
            position: absolute;
            right: 0;
            top: 0;
            z-index: 100;
            gap: 10px;
        }

        #header-buttons .feedback-button {
            background-color: #3498db;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 1.1em;
            border: none;
        }

        #header-buttons .feedback-button:hover {
            background-color: #2980b9;
        }

        #header-buttons .reset-button {
            background-color: #ff6347;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
            border: none;
            font-size: 1.1em;
        }

        #header-buttons .reset-button:hover {
            background-color: #b21f1f;
        }


        /* Mode Selection */
        select {
            margin: 20px 0;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            background: #34495e;
            border: 1px solid #2980b9;
            border-radius: 5px;
            color: #ecf0f1;
            transition: all 0.3s ease;
            outline: none
        }

        select:focus {
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }

        /* Editor Container */
        .editor-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 30px;
            transition: all 0.5s ease-in-out;
        }

        .editor {
            width: 30%;
            height: 300px;
            padding: 15px;
            background-color: #2d2d2d;
            color: white;
            font-family: monospace;
            border-radius: 10px;
            box-sizing: border-box;
            border: 2px solid #2980b9;
            transition: transform 0.3s ease;
            resize: none;
            overflow: auto;
        }

        .editor:hover {
            transform: scale(1.05);
        }

        #preview {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            overflow: auto;
            position: relative;
            background-color: white;
        }

        #preview:hover {
            transform: scale(1.01)
        }

        #preview.fullscreen-preview {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            border: none;
            border-radius: 0;
            box-shadow: none;
            transform: none;
            background: white;
        }

        .console {
            background-color: #333;
            color: #fff;
            padding: 15px;
            margin-top: 20px;
            width: 100%;
            border-radius: 5px;
            font-family: 'Courier New', Courier, monospace;
            min-height: 150px;
            overflow-y: auto;
        }

        /* Action Buttons */
        .buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px
        }

        .buttons button {
            padding: 10px;
            font-size: 1.5em;
            border-radius: 50%;
            margin: 0 5px;
            background: #3498db;
            border: none;
            color: white;
            transition: background 0.3s ease, transform 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            position: relative;
        }

        .buttons button .tooltip {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .buttons button:hover .tooltip {
            opacity: 1;
        }

        .buttons button:hover {
            background: #2980b9;
            transform: translateY(-5px);
        }

        .buttons button:active {
            transform: translateY(2px);
        }

        #full-page-button {
            position: absolute;
            top: 20px;
            left: 20px;
            cursor: pointer;
            font-size: 1.8em;
            color: #ecf0f1;
            transition: color 0.3s ease;
        }

        #full-page-button:hover {
            color: #3498db;
        }

        #preview-fullscreen-button {
            position: absolute;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 1.8em;
            color: #3498db;
            transition: color 0.3s ease;
            z-index: 100;
        }

        /* Floating Action Button */
        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #ff6347;
            color: white;
            font-size: 18px;
            padding: 20px;
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.3s ease;
            z-index: 10000;
        }

        .floating-btn:hover {
            transform: scale(1.1);
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            0% {
                transform: translateY(-100px);
            }

            100% {
                transform: translateY(0);
            }
        }

        /* Chatbot Modal */
        #chat-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            z-index: 10001;
            display: none;
            flex-direction: column;
            transition: all 0.3s ease-in-out;
        }

        #chat-modal.active {
            display: flex;
        }

        #chat-modal .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            cursor: pointer;
            color: #ff6347;
            transition: color 0.3s ease;
        }

        #chat-modal .close-button:hover {
            color: #3498db;
        }

        #chat-modal .messages {
            overflow-y: auto;
            max-height: 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 5px;

        }

        #chat-modal .message {
            padding: 10px;
            border-radius: 8px;
            max-width: 80%;
            align-self: flex-start;
            transition: all 0.3s ease;
            position: relative;
            /* needed for notification */
        }

        #chat-modal .message.user-message {
            position: relative;
        }

        #chat-modal .message.user-message {
            background: rgba(0, 255, 157, 0.1);
            align-self: flex-end;
            border-left: 4px solid #00ff9d;
        }

        #chat-modal .message.bot-message {
            background: rgba(255, 255, 255, 0.1);
            align-self: flex-start;
            border-right: 4px solid #1a73e8;
            position: relative;
        }

        #chat-modal .message.user-message .actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
        }

        #chat-modal .message.user-message:hover .actions {
            display: flex;
            gap: 5px;
        }

        #chat-modal .message.bot-message .actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
        }

        #chat-modal .message.bot-message:hover .actions {
            display: flex;
            gap: 5px
        }

        #chat-modal .message.user-message .actions button {
            background: rgba(52, 152, 219, 0.7);
            border: none;
            padding: 5px;
            cursor: pointer;
            font-size: 1.2em;
            border-radius: 5px;
            color: #ecf0f1;
            transition: background 0.3s ease;
        }

        #chat-modal .message.user-message .actions button:hover {
            background: #2980b9;
        }

        #chat-modal .message.bot-message .actions button {
            background: rgba(52, 152, 219, 0.7);
            border: none;
            padding: 5px;
            cursor: pointer;
            font-size: 1.2em;
            border-radius: 5px;
            color: #ecf0f1;
            transition: background 0.3s ease;
        }

        #chat-modal .message.bot-message .actions button:hover {
            background: #2980b9;
        }

        #chat-modal .message.bot-message pre {
            white-space: pre-wrap;
            margin: 5px 0;
            font-family: 'Consolas', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px
        }

        #chat-modal .reset-button {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            color: #ff6347;
            transition: background 0.3s ease, color 0.3s ease;
        }

        #chat-modal .reset-button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #3498db;
        }

        #chat-modal .input-area {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        #chat-modal .input-area textarea {
            flex: 1;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.05);
            color: #ecf0f1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            transition: background 0.3s ease;
            resize: vertical;
            font-size: 1.2em;
            min-height: 50px;
        }

        #chat-modal .input-area textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        #chat-modal .input-area button {
            background: #3498db;
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            color: #ecf0f1;
            transition: background 0.3s ease;
            font-size: 1.1em;
        }

        #chat-modal .input-area button:hover {
            background: #2980b9;
        }

        #chat-modal .thinking {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        #chat-modal .dot {
            width: 10px;
            height: 10px;
            background: #00ff9d;
            border-radius: 50%;
            animation: bounce 0.6s infinite ease-in-out;
        }

        #chat-modal .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        #chat-modal .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        #notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            pointer-events: none;

        }

        .notification {
            background: rgba(52, 152, 219, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
            opacity: 1;
            transition: opacity 0.5s ease, transform 0.5s ease;
            white-space: nowrap;
        }

        .notification.vanish {
            opacity: 0;
            transform: translateY(-20px);
        }

        #user-manual-popup {
            position: fixed;
            top: 25%;
            left: 25%;
            width: 50%;
            height: 50%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            color: #ecf0f1;
            padding: 30px;
            z-index: 10000;
            display: none;
            overflow-y: auto;
            /* Enable scrolling for long instructions */
            box-shadow: 0 0 40px rgba(52, 152, 219, 0.2);
        }

        #user-manual-popup.active {
            display: block;
        }

        #user-manual-popup .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            cursor: pointer;
            color: #ff6347;
            transition: color 0.3s ease;
        }

        #user-manual-popup .close-button:hover {
            color: #3498db;
        }

        #user-manual-popup h2 {
            margin-bottom: 20px;
            text-align: center;
        }

        #user-manual-popup ul {
            padding-left: 30px;
        }

        #user-manual-popup li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        #user-manual-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 1.8em;
            color: #ecf0f1;
            transition: color 0.3s ease;
        }

        #user-manual-icon:hover {
            color: #3498db;
        }

        #code-toggle-button {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            background-color: #3498db;
            color: white;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1000;
            transition: background 0.3s ease;
        }

        #code-toggle-button:hover {
            background-color: #2980b9;
        }

        .hidden {
            display: none !important;
        }

        /* Minimize Button Style */
        #minimize-button {
            position: absolute;
            top: 20px;
            right: 60px;
            cursor: pointer;
            font-size: 1.8em;
            color: #ecf0f1;
            transition: color 0.3s ease;
            z-index: 100;
        }

        #minimize-button:hover {
            color: #3498db;
        }

        .minimized-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 10px;
            max-width: 300px;
            z-index: 1000;
            display: none;
        }

        .minimized-container.active {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .minimized-container .minimized-item {
            background-color: #34495e;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .minimized-container .minimized-item:hover {
            background-color: #2980b9;
        }

        .minimized-container .close-minimize {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            font-size: 1.2em;
            color: #ff6347;
            transition: color 0.3s ease;
        }

        .minimized-container .close-minimize:hover {
            color: #3498db;
        }
    </style>
</head>

<body>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <h2>Codefusion is Loading</h2>
        <div id="loading-bar-container">
            <div id="loading-bar"></div>
        </div>
    </div>


    <div id="code-toggle-button" onclick="toggleEditorsVisibility()">
        <i class="fas fa-code"></i>
    </div>

    <div class="container">
        <h1>Codefusion</h1>
        <div id="header-buttons">
            <button class="feedback-button" onclick="sendFeedback()"><i class="fas fa-envelope"></i> Feedback </button>
            <button class="reset-button" onclick="resetAll()"><i class="fas fa-sync"></i> Reset </button>
            <i class="fas fa-question-circle" id="user-manual-icon" onclick="toggleUserManual()"></i>
            <i class="fas fa-expand-arrows-alt" id="full-page-button" onclick="toggleFullPageView()"
                style="cursor: pointer;"></i>
            <i class="fas fa-minus" id="minimize-button" onclick="minimizeCode()"></i>

        </div>
        <!-- Mode Selection -->
        <select id="modeSelect">
            <option value="html">HTML</option>
        </select>

        <!-- Editors Container -->
        <div class="editor-container">
            <textarea id="htmlEditor" class="editor" placeholder="Write your HTML code here..."></textarea>
            <textarea id="cssEditor" class="editor" placeholder="Write your CSS code here..."></textarea>
            <textarea id="jsEditor" class="editor" placeholder="Write your JavaScript code here..."></textarea>
        </div>
        <div id="full-page-view" class="">
            <button class="back-button" onclick="toggleFullPageView()"><i class="fas fa-arrow-left"></i></button>
            <iframe id="preview-fullpage"></iframe>
        </div>
        <!-- Action Buttons -->
        <div class="buttons">
            <button onclick="updatePreview()"><i class="fas fa-sync-alt"></i><span class="tooltip">Update
                    Preview</span></button>
            <button onclick="toggleEditors()"><i class="fas fa-code"></i><span class="tooltip">Toggle
                    Editors</span></button>
            <button onclick="segregateCode()"><i class="fas fa-code-branch"></i><span class="tooltip">Segregate
                    Code</span></button>
            <button onclick="copyCode('html')"><i class="fab fa-html5"></i><span class="tooltip">Copy
                    HTML</span></button>
            <button onclick="copyCode('css')"><i class="fab fa-css3-alt"></i><span class="tooltip">Copy
                    CSS</span></button>
            <button onclick="copyCode('js')"><i class="fab fa-js"></i><span class="tooltip">Copy
                    JavaScript</span></button>
            <button onclick="resetEditors()"><i class="fas fa-trash"></i><span class="tooltip">Reset
                    Editor</span></button>
            <button id="preview-fullscreen-button" onclick="togglePreviewFullscreen()"><i
                    class="fas fa-expand"></i></button>
        </div>
        <!-- Console Output -->
        <div class="console" id="console-output">Console output will appear here...</div>
        <div id="user-manual-popup">
            <span class="close-button" onclick="toggleUserManual()">×</span>
            <h2>User Manual</h2>
            <ul>
                <li><strong>Mode Selection:</strong> Choose between HTML, CSS, and JS to adjust the code that appears in the
                    editor areas.
                </li>
                <li><strong>Editor:</strong> The editor sections on the left are used to input the HTML, CSS, and JS code
                    for the application.</li>
                <li><strong>Update Preview:</strong> Updates the preview iframe with any changes done on the editor
                    sections.
                </li>
                <li><strong>Toggle Editor:</strong> Allows you to show or hide the editor sections.
                </li>
                <li><strong>Segregate Code:</strong> Seperates the code accordingly when using HTML.
                </li>
                <li><strong>Copy Code (HTML, CSS, JS):</strong> Copies the code from the selected section
                </li>
                <li><strong>Reset Editor:</strong> Clear all the contents from the editors.
                </li>
                <li><strong>Full page View:</strong> Expands the preview to fill the entire page.
                </li>
                <li><strong>Preview Fullscreen:</strong> Expands the preview section to full screen in the main window.
                </li>
            </ul>
        </div>
    </div>
    <!-- Chatbot Modal -->
    <div id="chat-modal" class="">
        <span class="close-button" onclick="toggleChatModal()">×</span>
        <div class="messages" id="chat-messages">
        </div>
        <button class="reset-button" onclick="resetChat()">Reset Chat</button>
        <div class="input-area">
            <textarea id="code-assistant-input"
                placeholder="What kind of code do you need assistance with?"></textarea>
            <button onclick="sendCodeQuery()"> <i class="fas fa-paper-plane"></i></button>
        </div>
        <div class="thinking" style="display: none">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>
    <!-- Floating Action Button -->
    <div class="floating-btn" onclick="toggleChatModal()">
        <i class="fas fa-plus"></i>
    </div>
    <div id="notification-container"></div>
    <!--Minimzed code Area-->
    <div class="minimized-container" id="minimized-code-container">
        <span class="close-minimize" onclick="toggleMinimize()">×</span>
    </div>

    <iframe id="preview"></iframe>

    <script>
        const htmlEditor = document.getElementById('htmlEditor');
        const cssEditor = document.getElementById('cssEditor');
        const jsEditor = document.getElementById('jsEditor');
        const preview = document.getElementById('preview');
        const fullPagePreview = document.getElementById('preview-fullpage')
        const modeSelect = document.getElementById('modeSelect');
        const consoleOutput = document.getElementById('console-output');
        const editorContainer = document.querySelector('.editor-container');
        const fullPageView = document.getElementById('full-page-view')
        const userManualPopup = document.getElementById('user-manual-popup')
        const userManualIcon = document.getElementById('user-manual-icon');
        const codeAssistantInput = document.getElementById('code-assistant-input');
        const chatModal = document.getElementById('chat-modal');
        const chatMessages = document.getElementById('chat-messages');
        const thinkingElement = document.querySelector('#chat-modal .thinking');
        const headerButtons = document.getElementById('header-buttons');
        const codeToggleButton = document.getElementById('code-toggle-button');
        const previewFullscreenButton = document.getElementById('preview-fullscreen-button');
        const notificationContainer = document.getElementById('notification-container');
        const minimizeButton = document.getElementById('minimize-button')
        const minimizedContainer = document.getElementById('minimized-code-container')
        const loadingScreen = document.getElementById('loading-screen');
        const loadingBar = document.getElementById('loading-bar');
        const mainContainer = document.querySelector('.container')



        let mode = "html";
        let currentView = "editor";
        let isFullPageViewActive = false;
        let isPreviewFullscreen = false;
        let apiKey = "AIzaSyB3vFjH7IsfekpbEuhWG2uKapRW1HcAxp4"
        let isMinimized = false;
        let minimizedItems = [];


        function initLoadingScreen() {
            const duration = Math.random() * 5000 + 1000; // 1 to 6 seconds
            let progress = 0
            const interval = setInterval(() => {
                progress += 100 / (duration / 100)
                loadingBar.style.width = progress + '%'
                if (progress >= 100) {
                    clearInterval(interval);
                    hideLoadingScreen();
                }
            }, 100)

        }

        function hideLoadingScreen() {
            loadingScreen.classList.add('hidden')
            setTimeout(() => {
                mainContainer.style.display = 'block'

            }, 500);
        }

        function toggleUserManual() {
            userManualPopup.classList.toggle('active')
        }

        function toggleFullPageView() {
            isFullPageViewActive = !isFullPageViewActive;
            if (isFullPageViewActive) {
                fullPageView.classList.add('active');
                updateFullPagePreview()
            }
            else {
                fullPageView.classList.remove('active');
            }

        }

        function toggleMinimize() {
            minimizedContainer.classList.toggle('active');
        }

        function resetAll() {
            resetEditors();
            resetChat();
            showNotification('Reset Complete!');
        }

        function sendFeedback() {
            window.location.href = 'mailto:flynnpontino@gmail.com?subject=Codefusion Feedback';
        }

        function minimizeCode() {
            isMinimized = !isMinimized
            if (isMinimized) {
                minimizedContainer.classList.add('active');
                let htmlContent = htmlEditor.value;
                let cssContent = cssEditor.value;
                let jsContent = jsEditor.value
                let previewFunction = `<div class="minimized-item" onclick="restoreCode('html')"><i class="fab fa-html5"></i> Restore HTML </div>`
                let cssFunction = `<div class="minimized-item" onclick="restoreCode('css')"><i class="fab fa-css3-alt"></i> Restore CSS</div>`
                let jsFunction = `<div class="minimized-item" onclick="restoreCode('js')"><i class="fab fa-js"></i> Restore JS</div>`

                minimizedContainer.innerHTML = `<span class="close-minimize" onclick="toggleMinimize()">×</span>` + (htmlContent ? previewFunction : '') + ( cssContent ? cssFunction : '') + (jsContent ? jsFunction : '');

}
        else {
            minimizedContainer.classList.remove('active');
        }
    }


    function restoreCode(type) {
        if (type === 'html') {
            htmlEditor.value = htmlEditor.value;
        }
        if (type === 'css') {
            cssEditor.value = cssEditor.value
        }
        if (type === 'js') {
            jsEditor.value = jsEditor.value
        }
        toggleMinimize()
    }

    function toggleEditorsVisibility() {
        editorContainer.classList.toggle('hidden');
        if (editorContainer.classList.contains('hidden')) {
            codeToggleButton.innerHTML = `<i class="fas fa-code"></i>`
        } else {
            codeToggleButton.innerHTML = `<i class="fas fa-code"></i>`
        }
    }


    function updateFullPagePreview() {
        const htmlCode = htmlEditor.value;
        const cssCode = cssEditor.value;
        const jsCode = jsEditor.value;

        const iframeDoc = fullPagePreview.contentDocument || fullPagePreview.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(htmlCode);
        iframeDoc.close();

        const style = iframeDoc.createElement('style');
        style.innerHTML = cssCode;
        iframeDoc.head.appendChild(style);

        const script = iframeDoc.createElement('script');
        script.innerHTML = jsCode;
        iframeDoc.body.appendChild(script);

    }

    function togglePreviewFullscreen() {
        isPreviewFullscreen = !isPreviewFullscreen;
        preview.classList.toggle('fullscreen-preview', isPreviewFullscreen);
        previewFullscreenButton.innerHTML = isPreviewFullscreen ? `<i class="fas fa-compress"></i>` : `<i class="fas fa-expand"></i>`
    }

    function updatePreview() {
        const htmlCode = htmlEditor.value;
        const cssCode = cssEditor.value;
        const jsCode = jsEditor.value;
        const iframeDoc = preview.contentDocument || preview.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(htmlCode);
        iframeDoc.close();

        const style = iframeDoc.createElement('style');
        style.innerHTML = cssCode;
        iframeDoc.head.appendChild(style);

        const script = iframeDoc.createElement('script');
        script.innerHTML = jsCode;
        iframeDoc.body.appendChild(script);
        consoleOutput.innerHTML = `Successfully updated preview`;
    }

    function showNotification(message) {
        const notification = document.createElement('div');
        notification.classList.add('notification');
        notification.textContent = message;
        notificationContainer.appendChild(notification);

        setTimeout(() => {
            notification.classList.add('vanish')
            notification.addEventListener('transitionend', () => {
                notificationContainer.removeChild(notification);
            });
        }, 1500);
    }

    function addMessage(content, isUser, isBotCode = false) {
        const message = document.createElement('div');
        message.classList.add('message', isUser ? 'user-message' : 'bot-message');
        if (isUser) {
            message.innerHTML = `
           ${content}
              <div class="actions">
                <button onclick="editUserMessage(this)"><i class="fas fa-edit"></i></button>
             </div>`;

        } else {

            let messageContent = content;
            let codeSnippet = null;
            const codeMatch = messageContent.match(/```([\w-]+)?\s*([\s\S]*?)```/);

            if (codeMatch) {
                codeSnippet = `<pre><code class="language-${codeMatch[1] || 'plaintext'}">${codeMatch[2].trim()}</code></pre>`
                messageContent = messageContent.replace(codeMatch[0], "").trim()
            }

            message.innerHTML = `
           ${messageContent}
          ${codeSnippet || ""}
              <div class="actions">
                 <button onclick="copyBotMessage(this)"><i class="fas fa-copy"></i></button>
             </div>`;
        }
        chatMessages.appendChild(message);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function editUserMessage(button) {
        const messageElement = button.closest('.message');
        const initialText = messageElement.firstChild.textContent
        const textarea = document.createElement('textarea');
        textarea.value = initialText;
        textarea.style.width = '100%';
        textarea.style.minHeight = '100px';
        textarea.style.boxSizing = 'border-box';
        textarea.style.color = '#ecf0f1';
        textarea.style.background = 'rgba(0, 0, 0, 0.3)';
        textarea.style.padding = '10px'
        textarea.style.borderRadius = '5px'
        textarea.style.margin = '5px 0'
        textarea.style.resize = 'vertical';

        const saveButton = document.createElement('button');
        saveButton.innerText = "Save";
        saveButton.style.background = '#3498db';
        saveButton.style.color = '#ecf0f1';
        saveButton.style.padding = '8px 12px';
        saveButton.style.borderRadius = '5px';
        saveButton.style.cursor = 'pointer';
        saveButton.style.border = 'none'
        saveButton.style.marginTop = '5px'
        saveButton.style.transition = 'background 0.3s ease';
        saveButton.style.display = 'inline-block'

        saveButton.addEventListener('mouseover', function () {
            saveButton.style.background = '#2980b9';
        });
        saveButton.addEventListener('mouseout', function () {
            saveButton.style.background = '#3498db';
        });


        messageElement.innerHTML = '';
        messageElement.appendChild(textarea);
        messageElement.appendChild(saveButton);

        saveButton.addEventListener('click', function () {
            const updatedContent = textarea.value;
            messageElement.innerHTML =
                `${updatedContent}
              <div class="actions">
                <button onclick="editUserMessage(this)"><i class="fas fa-edit"></i></button>
             </div>`;
        });
    }


    function copyBotMessage(button) {
        const messageElement = button.closest('.message');
        const codeBlock = messageElement.querySelector('pre code');
        const textContent = messageElement.firstChild.textContent;

        const code = codeBlock ? codeBlock.textContent : null;
        const combined = code ? textContent + "\n" + code : textContent
        navigator.clipboard.writeText(combined).then(() => {
            alert("Copied to clipboard!");
        }).catch(err => console.error("Error copying:", err));
    }

    function segregateCode() {
        const code = htmlEditor.value;
        if (!code) return consoleOutput.innerHTML = `No HTML code detected.`;

        let segregatedHTML = "";
        let segregatedCSS = "";
        let segregatedJS = "";

        // Extract HTML outside script and style tags
        segregatedHTML = code.replace(/<script[\s\S]*?<\/script>/gi, '').replace(/<style[\s\S]*?<\/style>/gi, '').trim();

        // Extract JavaScript inside script tags
        const scriptMatches = code.matchAll(/<script>([\s\S]*?)<\/script>/gi);
        for (const match of scriptMatches) {
            segregatedJS += match[1].trim() + '\n';
        }

        // Extract CSS inside style tags
        const styleMatches = code.matchAll(/<style>([\s\S]*?)<\/style>/gi);
        for (const match of styleMatches) {
            segregatedCSS += match[1].trim() + '\n';
        }
        htmlEditor.value = segregatedHTML.trim();
        cssEditor.value = segregatedCSS.trim();
        jsEditor.value = segregatedJS.trim();
        consoleOutput.innerHTML = `HTML, CSS, and JS code segregated.`;
        updatePreview();

    }

    async function sendCodeQuery() {
        const query = codeAssistantInput.value.trim();
        if (!query) return alert('Please enter your query');
        thinkingElement.style.display = "flex";
        codeAssistantInput.disabled = true;
        addMessage(query, true)
        try {
            const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `CodyPro v6 (GPT Developer Edition) is your steadfast pair programmer, armed with enhanced code generation ability, online access for the latest APIs, and custom commands to save your session state so you can recall it in a new session later. /help will tell you all about it. Say "Hello" to start! ${query} Only give code related output to the query that is related to HTML, do not provide full documents.  If the user did not ask for specific language, output the code with the html or plaintext code language.`
                        }]
                    }]
                })
            });
            if (!response.ok) {
                console.error(`API request failed with status ${response.status}`);
                const errorData = await response.json();
                console.error("API error details:", errorData);
                addMessage(`Error: Could not get response from Cody AI`, false)
                thinkingElement.style.display = "none";
                codeAssistantInput.disabled = false;
                return;
            }
            const data = await response.json();
            thinkingElement.style.display = "none";
            codeAssistantInput.disabled = false;
            if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0].text) {
                let responseText = data.candidates[0].content.parts[0].text.trim();
                addMessage(responseText, false);
                htmlEditor.value += "\n" + responseText;
                updatePreview();
            } else {
                console.error("No response text found in data:", data);
                addMessage(`Error: No response from Cody AI`, false)
            }

        } catch (error) {
            console.error("Error during API request:", error);
            addMessage(`Error: ${error}`, false)
            thinkingElement.style.display = "none";
            codeAssistantInput.disabled = false;
        }
        codeAssistantInput.value = '';
    }


    function toggleChatModal() {
        chatModal.classList.toggle('active');
    }

    function resetChat() {
        chatMessages.innerHTML = '';
        showNotification('Chat history cleared.');
    }

    function toggleEditors() {
        const editorContainer = document.querySelector('.editor-container');
        editorContainer.style.display = editorContainer.style.display === 'none' ? 'flex' : 'none';
    }

    function copyCode(type) {
        let code;
        if (type === 'html') {
            code = htmlEditor.value;
        } else if (type === 'css') {
            code = cssEditor.value;
        } else {
            code = jsEditor.value;
        }

        const textarea = document.createElement('textarea');
        textarea.value = code;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        alert(`${type.toUpperCase()} code copied!`);
    }

    function resetEditors() {
        htmlEditor.value = '';
        cssEditor.value = '';
        jsEditor.value = '';
        consoleOutput.innerHTML = `Editor reset.`
        updatePreview();
    }

    modeSelect.addEventListener('change', function () {
        const selectedMode = modeSelect.value;
        htmlEditor.style.display = selectedMode === 'html' ? 'block' : 'none';
        cssEditor.style.display = selectedMode === 'css' ? 'block' : 'none';
        jsEditor.style.display = selectedMode === 'js' ? 'block' : 'none';
        mode = selectedMode;
        consoleOutput.innerHTML = `Mode set to ${mode}`
    });

    htmlEditor.addEventListener('input', updatePreview);
    cssEditor.addEventListener('input', updatePreview);
    jsEditor.addEventListener('input', updatePreview);

    codeAssistantInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendCodeQuery();
        }
    });
     initLoadingScreen();
    updatePreview();
</script>

</body>
</html>
