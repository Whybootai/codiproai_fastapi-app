<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codefusion - Futuristic Multi-Language Code Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            /* Futuristic Theme Colors */
            --bg-color: #0a0a1a;
            --header-bg: #1a1a2e;
            --editor-bg: #1e1e2f;
            --text-color: #e0e0e0;
            --text-muted: #888;
            --border-color: #444;
            --accent-color: #00ff88;
            --btn-bg: #2a2a40;
            --glow-color: rgba(0, 255, 136, 0.3);
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--header-bg);
            padding: 15px 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
            border-bottom: 1px solid var(--accent-color);
        }

        header h1 {
            font-size: 2rem;
            margin: 0;
            letter-spacing: 2px;
            font-weight: 500;
            text-shadow: 0 0 5px var(--glow-color);
        }

        header .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        header .controls button {
            background: var(--btn-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }

        header .controls button:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
            box-shadow: 0 0 10px var(--glow-color);
        }

        header .controls .theme-toggle {
            font-size: 1.2rem;
        }

        main {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
        }

        .editor-container {
            width: 70%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .editor-container textarea {
            flex: 1;
            background-color: var(--editor-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            padding: 15px;
            border-radius: 8px;
            resize: none;
            box-shadow: 0 0 10px var(--glow-color);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .editor-container textarea::placeholder {
            color: var(--text-muted);
        }

        .preview-container {
            width: 30%;
            position: relative;
            background: var(--editor-bg);
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 10px var(--glow-color);
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s, border-color 0.3s;
        }

        .preview-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            border: none;
            transform: none;
        }

        .preview-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .preview-container .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--btn-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }

        .preview-container .close-btn:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
            box-shadow: 0 0 10px var(--glow-color);
        }

        .preview-container .fullScreen-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--btn-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }

        .preview-container .fullScreen-btn:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
            box-shadow: 0 0 10px var(--glow-color);
        }

        footer {
            background-color: var(--header-bg);
            text-align: center;
            padding: 15px;
            font-size: 0.9rem;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.6);
            border-top: 1px solid var(--accent-color);
        }

        footer span {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .chatbox-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent-color);
            border: none;
            color: var(--bg-color);
            font-size: 1.3rem;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 0 10px var(--glow-color);
        }

        .chatbox-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-color);
        }

        .chat-popup {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--header-bg);
            color: var(--text-color);
            border-radius: 12px;
            box-shadow: 0 0 10px var(--glow-color);
            max-height: 400px;
            width: 300px;
            display: none;
            flex-direction: column;
            z-index: 1000;
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0;
            transform: translateY(20px);
        }

        .chat-popup.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid var(--accent-color);
            font-weight: 500;
        }

        .chat-header .close-chat {
            cursor: pointer;
            color: var(--accent-color);
            font-size: 1.3rem;
            transition: color 0.3s;
        }

        .chat-header .close-chat:hover {
            color: var(--text-color);
        }

        .chat-messages {
            padding: 12px;
            overflow-y: auto;
            flex: 1;
        }

        .chat-message {
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 10px;
            word-wrap: break-word;
            max-width: 80%;
            transition: all 0.3s;
        }

        .chat-message.user-message {
            background: var(--btn-bg);
            align-self: flex-end;
            border: 1px solid var(--accent-color);
        }

        .chat-message.bot-message {
            background: var(--editor-bg);
            align-self: flex-start;
            border: 1px solid var(--accent-color);
            position: relative;
        }

        .chat-message.bot-message .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .chat-message.bot-message:hover .copy-btn {
            display: block;
        }

        .chat-message.bot-message .copy-btn:hover {
            color: var(--accent-color);
        }

        .chat-message.bot-message pre {
            white-space: pre-wrap;
            margin: 8px 0;
            font-family: monospace;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
        }

        .chat-input-area {
            display: flex;
            padding: 12px;
            border-top: 1px solid var(--accent-color);
            align-items: center;
        }

        .chat-input-area textarea {
            flex: 1;
            resize: none;
            background: none;
            color: var(--text-color);
            padding: 10px;
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            font-size: 1em;
            min-height: 35px;
            outline: none;
        }

        .chat-input-area textarea::placeholder {
            color: var(--text-muted);
        }

        .chat-input-area button {
            background: var(--accent-color);
            border: none;
            color: var(--bg-color);
            cursor: pointer;
            font-size: 1.3rem;
            padding: 10px;
            border-radius: 8px;
            margin-left: 10px;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .chat-input-area button:hover {
            background-color: #00cc77;
            box-shadow: 0 0 10px var(--glow-color);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .loading-overlay.active {
            display: flex;
        }

        .circular-loader {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 5px solid var(--accent-color);
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <h1>Codefusion</h1>
        <div class="controls">
            <div class="dropdown">
                <button class="toggle">Inject API</button>
                <input type="password" placeholder="Enter Security Code" id="security-code">
            </div>
            <button id="segregation-btn" class="segregation-toggle">
                <i class="fas fa-code-branch"></i>
            </button>
            <button id="theme-toggle" class="theme-toggle">
                <i class="fas fa-sun"></i>
            </button>
            <button id="feedback-btn" onclick="sendFeedback()">
                <i class="fas fa-envelope"></i>
            </button>
            <button id="reset-btn">Reset</button>
            <button id="toggle-preview">Toggle Preview</button>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="editor-container">
            <textarea id="html-editor" placeholder="Write HTML here..."></textarea>
            <textarea id="css-editor" placeholder="Write CSS here..."></textarea>
            <textarea id="js-editor" placeholder="Write JavaScript here..."></textarea>
        </div>
        <div class="preview-container">
            <button class="fullScreen-btn"><i class="fas fa-expand"></i></button>
            <button class="close-btn">×</button>
            <iframe id="preview-frame"></iframe>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <span>Codefusion - Your Dream App, Live in 5!</span>
    </footer>

    <!-- Chat Toggle -->
    <button class="chatbox-toggle">
        <i class="fas fa-comment-dots"></i>
    </button>

    <!-- Chat Popup -->
    <div class="chat-popup">
        <div class="chat-header">
            <span>Codefusion AI Assistant</span>
            <span class="close-chat">×</span>
        </div>
        <div class="chat-messages"></div>
        <div class="chat-input-area">
            <textarea placeholder="Type your message..."></textarea>
            <button><i class="fas fa-paper-plane"></i></button>
        </div>
        <div class="loading-overlay">
            <div class="circular-loader"></div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification"></div>

    <!-- JavaScript -->
    <script>
        const body = document.body;
        const htmlEditor = document.getElementById('html-editor');
        const cssEditor = document.getElementById('css-editor');
        const jsEditor = document.getElementById('js-editor');
        const previewFrame = document.getElementById('preview-frame');
        const togglePreviewBtn = document.getElementById('toggle-preview');
        const resetBtn = document.getElementById('reset-btn');
        const closeBtn = document.querySelector('.close-btn');
        const fullScreenBtn = document.querySelector('.fullScreen-btn');
        const segregationBtn = document.getElementById('segregation-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const securityCodeInput = document.getElementById('security-code');
        const dropdownToggle = document.querySelector('.dropdown .toggle');
        const chatboxToggle = document.querySelector('.chatbox-toggle');
        const chatPopup = document.querySelector('.chat-popup');
        const closeChatBtn = document.querySelector('.chat-header .close-chat');
        const chatMessages = document.querySelector('.chat-messages');
        const chatInput = document.querySelector('.chat-input-area textarea');
        const chatSendBtn = document.querySelector('.chat-input-area button');
        const loadingOverlay = document.querySelector('.loading-overlay');
        const notification = document.querySelector('.notification');

        let defaultPrompt = `You are an AI assistant named Cody, specializing in helping developers write, debug, and optimize code with precision and efficiency. You empower users to interact seamlessly with their codebase, offering advanced capabilities for auto-completion, error detection, refactoring, and generating boilerplate code. Your expertise lies in transforming ideas into well-structured, maintainable, and efficient code tailored to the user's project requirements.`;
        let apiKey = "";
        let isSegregationActive = false;
        let isDarkMode = true;

        function sendFeedback() {
            window.location.href = 'mailto:Flynnpontino@gmail.com?subject=Codefusion Feedback';
        }

        function updatePreview() {
            let htmlCode = htmlEditor.value;
            if (isSegregationActive) {
                htmlCode = segregateCode();
            }
            const css = `<style>${cssEditor.value}</style>`;
            const js = `<script>${jsEditor.value}<\/script>`;
            previewFrame.srcdoc = `${htmlCode}${css}${js}`;
            showNotification('Preview Updated', 'success');
        }

        function togglePreview() {
            const previewContainer = previewFrame.parentElement;
            if (previewContainer.classList.contains('fullscreen')) {
                previewContainer.classList.remove('fullscreen')
                fullScreenBtn.innerHTML = `<i class="fas fa-expand"></i>`
                showNotification('Preview exit full screen', 'success');
            } else {
                previewContainer.classList.add('fullscreen')
                fullScreenBtn.innerHTML = `<i class="fas fa-compress"></i>`
                showNotification('Preview enter full screen', 'success');
            }
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            body.classList.toggle('light-theme', !isDarkMode);
            themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>'            : '<i class="fas fa-moon"></i>';
            showNotification(isDarkMode ? 'Dark theme enabled' : 'Light theme enabled', 'success');
        }

        function resetEditors() {
            htmlEditor.value = '';
            cssEditor.value = '';
            jsEditor.value = '';
            previewFrame.srcdoc = '';
            showNotification('Editors Reset', 'success');
        }

        function showNotification(message, type = '') {
            notification.textContent = message;
            notification.classList.add('active');
            if (type === 'success') {
                notification.classList.add('success');
            }

            setTimeout(() => {
                notification.classList.remove('active');
                notification.classList.remove('success');
            }, 3000);
        }

        function segregateCode() {
            const code = htmlEditor.value;
            if (!code) return consoleOutput.innerHTML = `No HTML code detected.`;

            let segregatedHTML = "";
            let segregatedCSS = "";
            let segregatedJS = "";

            // Extract HTML outside script and style tags
            segregatedHTML = code.replace(/<script[\s\S]*?<\/script>/gi, '').replace(/<style[\s\S]*?<\/style>/gi, '').trim();

            // Extract JavaScript inside script tags
            const scriptMatches = code.matchAll(/<script>([\s\S]*?)<\/script>/gi);
            for (const match of scriptMatches) {
                segregatedJS += match[1].trim() + '\n';
            }

            // Extract CSS inside style tags
            const styleMatches = code.matchAll(/<style>([\s\S]*?)<\/style>/gi);
            for (const match of styleMatches) {
                segregatedCSS += match[1].trim() + '\n';
            }
            htmlEditor.value = segregatedHTML.trim();
            cssEditor.value = segregatedCSS.trim();
            jsEditor.value = segregatedJS.trim();
            return htmlEditor.value;
        }

        resetBtn.addEventListener('click', resetEditors);
        togglePreviewBtn.addEventListener('click', () => {
            previewFrame.parentElement.style.display = previewFrame.parentElement.style.display === 'none' ? 'block' : 'none';
            showNotification('Preview Toggled', 'success');
        });

        closeBtn.addEventListener('click', () => {
            previewFrame.parentElement.style.display = 'none';
            showNotification('Preview Closed', 'success');
        });

        fullScreenBtn.addEventListener('click', togglePreview);

        themeToggle.addEventListener('click', toggleTheme);

        segregationBtn.addEventListener('click', () => {
            isSegregationActive = !isSegregationActive;
            segregationBtn.classList.toggle('active', isSegregationActive);
            if (isSegregationActive) {
                showNotification('HTML segregation active', 'success');
            } else {
                showNotification('HTML segregation inactive', 'success');
            }
            updatePreview();
        });

        dropdownToggle.addEventListener('click', () => {
            securityCodeInput.style.display = securityCodeInput.style.display === 'none' ? 'block' : 'none';
        });

        securityCodeInput.addEventListener('input', () => {
            if (securityCodeInput.value === '123456') {
                apiKey = 'AIzaSyB4ugVm-HR9SL4dxAhk-FoAkczkOu1NqGo'; // Injected API Key
                showNotification('API Key Injected', 'success');
                securityCodeInput.value = '';
                securityCodeInput.style.display = 'none';
            }
        });

        htmlEditor.addEventListener('input', updatePreview);
        cssEditor.addEventListener('input', updatePreview);
        jsEditor.addEventListener('input', updatePreview);

        // ChatBox
        chatboxToggle.addEventListener('click', () => {
            chatPopup.classList.toggle('active');
        });

        closeChatBtn.addEventListener('click', () => {
            chatPopup.classList.remove('active');
        });

        chatSendBtn.addEventListener('click', sendMessage);

        chatInput.addEventListener('keydown', function (event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = chatInput.value.trim();

            if (!message) return;
            addMessage(message, true);
            chatInput.value = "";

            loadingOverlay.classList.add('active');

            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `${defaultPrompt} ${message} Be highly detailed and include code when necessary. Output the code with the html or plaintext code language.`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    console.error(`API request failed with status ${response.status}`);
                    const errorData = await response.json();
                    console.error("API error details:", errorData);
                    addMessage(`Error: Could not get response from Codefusion AI`, false);
                    loadingOverlay.classList.remove('active');
                    return;
                }

                const data = await response.json();
                loadingOverlay.classList.remove('active');
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0].text) {
                    let responseText = data.candidates[0].content.parts[0].text.trim();
                    addMessage(responseText, false);
                } else {
                    console.error("No response text found in data:", data);
                    addMessage(`Error: No response from Codefusion AI`, false);
                }
            } catch (error) {
                console.error("Error during API request:", error);
                addMessage(`Error: ${error}`, false);
                loadingOverlay.classList.remove('active');
            }
        }

        function addMessage(content, isUser) {
            const message = document.createElement('div');
            message.classList.add('chat-message', isUser ? 'user-message' : 'bot-message');
            if (isUser) {
                message.innerHTML = content;
            } else {
                let messageContent = content;
                let codeSnippet = null;
                const codeMatch = messageContent.match(/```([\w-]+)?\s*([\s\S]*?)```/);

                if (codeMatch) {
                    codeSnippet = `<pre><code class="language-${codeMatch[1] || 'plaintext'}">${codeMatch[2].trim()}</code></pre>`;
                    messageContent = messageContent.replace(codeMatch[0], "").trim();
                }

                message.innerHTML = `
                    ${messageContent}
                    ${codeSnippet || ""}
                    <button class="copy-btn"><i class="fas fa-copy"></i></button>
                `;
            }
            chatMessages.appendChild(message);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            if (!isUser) {
                const copyButton = message.querySelector('.copy-btn');
                if (copyButton) {
                    copyButton.addEventListener('click', () => {
                        copyBotMessage(message);
                    });
                }
            }
        }

        function copyBotMessage(messageElement) {
            const codeBlock = messageElement.querySelector('pre code');
            const textContent = messageElement.firstChild.textContent;

            const code = codeBlock ? codeBlock.textContent : null;
            const combined = code ? textContent + "\n" + code : textContent;
            navigator.clipboard.writeText(combined).then(() => {
                showNotification("Copied to Clipboard!", 'success');
            }).catch(err => console.error("Error copying:", err));
        }
    </script>
</body>

</html>
