<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codefusion - Futuristic Multi-Language Code Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            /* Dark Theme Colors */
            --bg-color: #1e1e2f;
            --header-bg: #27293d;
            --editor-bg: #282c34;
            --text-color: #ffffff;
            --text-muted: #999;
            --border-color: #444;
            --accent-color: #28a745;
            --btn-bg: #44475a;
            font-size: 16px;
            /* Base font size */
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--header-bg);
            padding: 1em 1.5em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        header h1 {
            font-size: 1.75rem;
            margin: 0;
            letter-spacing: 1px;
            font-weight: 400;
        }

        header .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        header .controls button {
             background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s;
            position: relative;
            /* For Tooltip Position */
        }

        header .controls button:hover {
            background-color: var(--btn-bg);
        }

         header .controls button .tooltiptext {
            visibility: hidden;
            width: auto;
            background-color: var(--btn-bg);
            color: var(--text-color);
            text-align: center;
            padding: 5px 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        header .controls button:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

          .header .controls #toggle-buttons {
              font-size: 1.7rem;
            }


        header .controls .theme-toggle {
            font-size: 1.2rem;
        }

        main {
            display: flex;
            flex: 1;
            padding: 0.6em;
            flex-direction: column;
            /* Default to column for mobile */
        }

        .editor-container {
            width: 100%;
            /* Take up full width by default */
            display: flex;
            flex-direction: column;
            padding: 0.9em;
            gap: 0.9em;
        }

        .editor-container textarea {
            flex: 1;
            background-color: var(--editor-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            padding: 0.75em;
            border-radius: 8px;
            resize: none;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .editor-container textarea::placeholder {
            color: var(--text-muted);
        }

        .preview-container {
            width: 100%;
            position: relative;
            background: var(--editor-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s, border-color 0.3s;
            height: auto;
            margin-top: 1em;
            /* Space between editor and preview on mobile */
        }

        .preview-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            border: none;
            transform: none;
        }

        .preview-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .preview-container .close-btn {
            position: absolute;
            top: 0.9em;
            right: 0.9em;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.3s ease-in-out, color 0.3s;
            z-index: 100;
        }

        .preview-container .close-btn.fullscreen-btn {
            left: 0.9em;
            right: auto;
        }

        .preview-container .close-btn:hover {
            color: #ff5555;
        }

        .preview-container .fullScreen-btn {
            position: absolute;
            top: 0.9em;
            left: 0.9em;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.3s ease-in-out, color 0.3s;
            z-index: 100;
        }

        .preview-container .fullScreen-btn:hover {
            color: #ff5555;
        }

        footer {
            background-color: var(--header-bg);
            text-align: center;
            padding: 0.9em;
            font-size: 0.9rem;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.2);
        }

        footer span {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .dropdown {
            position: relative;
        }

        .dropdown input {
            background: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 0.5em;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        .dropdown input[type="password"] {
            display: none;
        }

        .dropdown .toggle {
            cursor: pointer;
        }

        .notification {
            background: var(--border-color);
            padding: 0.75em;
            position: absolute;
            top: -3.125em;
            right: 1.25em;
            color: var(--text-color);
            border-radius: 8px;
            display: none;
            transition: all 0.5s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .notification.success {
            background: var(--accent-color);
        }

        .notification.copy {
            background: var(--text-muted);
        }

        .chatbox-toggle {
            position: fixed;
            bottom: 1.25em;
            right: 1.25em;
            background: var(--btn-bg);
            border: none;
            color: var(--text-color);
            font-size: 1.3rem;
            padding: 0.75em;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            transition: transform 0.3s, background-color 0.3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .chatbox-toggle:hover {
            transform: scale(1.1)
        }

        .chat-popup {
            position: fixed;
            bottom: 5em;
            right: 1.25em;
            background: var(--header-bg);
            color: var(--text-color);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            max-height: 25em;
            /* Adjusted to rem */
            width: 18.75em;
            /* Adjusted to rem */
            display: none;
            flex-direction: column;
            z-index: 1000;
            transition: opacity 0.3s, transform 0.3s, background-color 0.3s;
            opacity: 0;
            transform: translateY(20px);
        }

        .chat-popup.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            padding: 0.75em;
            border-bottom: 1px solid var(--border-color);
            font-weight: 500;
        }

        .chat-header .close-chat {
            cursor: pointer;
            color: #ff5555;
            font-size: 1.3rem;
            transition: color 0.3s;
        }

        .chat-header .reset-chat {
            cursor: pointer;
            color: var(--text-color);
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        .chat-header .reset-chat:hover {
            color: var(--accent-color);
        }

        .chat-header .close-chat:hover {
            color: var(--text-color);
        }

        .chat-messages {
            padding: 0.75em;
            overflow-y: auto;
            flex: 1;
        }

        .chat-message {
            padding: 0.75em;
            margin-bottom: 0.75em;
            border-radius: 10px;
            word-wrap: break-word;
            max-width: 80%;
            transition: all 0.3s;
            position: relative;
        }

        .chat-message.user-message {
            background: var(--btn-bg);
            align-self: flex-end;
        }

        .chat-message.user-message .edit-btn {
            position: absolute;
            top: 8px;
            right: 35px;
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.3s
        }

        .chat-message.user-message:hover .edit-btn {
            display: block;
        }

        .chat-message.user-message .edit-btn:hover {
            color: var(--accent-color);
        }

        .chat-message.user-message .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.3s
        }

        .chat-message.user-message:hover .copy-btn {
            display: block;
        }

        .chat-message.user-message .copy-btn:hover {
            color: var(--accent-color);
        }

        .chat-message.bot-message {
            background: var(--editor-bg);
            align-self: flex-start;
            position: relative;
        }

        .chat-message.bot-message .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.3s
        }

        .chat-message.bot-message:hover .copy-btn {
            display: block;
        }

        .chat-message.bot-message .copy-btn:hover {
            color: var(--accent-color);
        }

        .chat-message.bot-message pre {
            white-space: pre-wrap;
            margin: 0.5em 0;
            font-family: monospace;
            background: rgba(0, 0, 0, 0.2);
            padding: 0.6em;
            border-radius: 8px;
            overflow-x: auto;
        }

        .chat-input-area {
            display: flex;
            padding: 0.75em;
            border-top: 1px solid var(--border-color);
            align-items: center
        }

        .chat-input-area textarea {
            flex: 1;
            resize: none;
            background: none;
            color: var(--text-color);
            padding: 0.6em;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            min-height: 2.2em;
            outline: none;
        }

        .chat-input-area textarea::placeholder {
            color: var(--text-muted)
        }

        .chat-input-area button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 1.3rem
        }

        .chat-input-area button:hover {
            color: var(--accent-color);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .loading-overlay.active {
            display: flex;
        }

        .circular-loader {
            width: 2.8em;
            height: 2.8em;
            border-radius: 50%;
            border: 5px solid var(--text-color);
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        .segregation-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 0.5em;
            border-radius: 6px;
            transition: all 0.3s, color 0.3s;
            position: relative;
        }

           .segregation-toggle:hover .tooltiptext {
             visibility: visible;
            opacity: 1;
        }


        .segregation-toggle.active {
            color: var(--accent-color);
        }

        .segregation-toggle:hover {
            color: var(--accent-color);
        }

           .segregation-toggle .tooltiptext {
            visibility: hidden;
            width: auto;
            background-color: var(--btn-bg);
            color: var(--text-color);
            text-align: center;
            padding: 5px 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }



        @keyframes spin {
            0% {
                transform: rotate(0deg)
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Light Theme Colors */
        body.light-theme {
            --bg-color: #f0f2f5;
            --header-bg: #e9ecef;
            --editor-bg: #f8f9fa;
            --text-color: #212529;
            --text-muted: #6c757d;
            --border-color: #ced4da;
            --btn-bg: #dee2e6;
        }
${cssEditor.value}
            /* Futuristic Theme Colors */
            --bg-color: #0a0a1a;
            --header-bg: #1a1a2e;
            --editor-bg: #1e1e2f;
            --text-color: #e0e0e0;
            --text-muted: #888;
            --border-color: #444;
            --accent-color: #00ff88;
            --btn-bg: #2a2a40;
            --glow-color: rgba(0, 255, 136, 0.3);
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--header-bg);
            padding: 1em 1.5em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
            border-bottom: 1px solid var(--accent-color);
        }

        header h1 {
            font-size: 1.75rem;
            margin: 0;
            letter-spacing: 2px;
            font-weight: 500;
            text-shadow: 0 0 5px var(--glow-color);
        }

        header .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        header .controls button {
            background: var(--btn-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5em 0.8em;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
            position: relative;
        }

          header .controls button:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
            box-shadow: 0 0 10px var(--glow-color);
        }

          header .controls button .tooltiptext {
            visibility: hidden;
            width: auto;
            background-color: var(--btn-bg);
            color: var(--text-color);
            text-align: center;
            padding: 5px 10px;
            border-radius: 6px;
             position: absolute;
            z-index: 1;
            bottom: 125%;
             left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
          }

           header .controls button:hover .tooltiptext {
             visibility: visible;
            opacity: 1;
        }


        .header .controls #toggle-buttons {
             font-size: 1.7rem;
        }


        header .controls .theme-toggle {
             font-size: 1.2rem;
        }

        main {
            display: flex;
            flex: 1;
            padding: 1.25em;
            gap: 1.25em;
            flex-direction: column;
            /* Default to column for mobile */
        }

        .editor-container {
            width: 100%;
            /* Take up full width by default */
            display: flex;
            flex-direction: column;
            gap: 1.25em;
        }

        .editor-container textarea {
            flex: 1;
            background-color: var(--editor-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
             font-family: 'Fira Code', monospace;
            font-size: 1rem;
            padding: 1em;
            border-radius: 8px;
             resize: none;
            box-shadow: 0 0 10px var(--glow-color);
             transition: background-color 0.3s, border-color 0.3s;
        }

        .editor-container textarea::placeholder {
            color: var(--text-muted);
        }

        .preview-container {
            width: 100%;
            position: relative;
             background: var(--editor-bg);
            border: 1px solid var(--accent-color);
             border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 10px var(--glow-color);
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s, border-color 0.3s;
            margin-top: 1.25em;
        }

        .preview-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
             height: 100%;
            z-index: 1000;
             border: none;
            transform: none;
        }

        .preview-container iframe {
            width: 100%;
             height: 100%;
            border: none;
        }

        .preview-container .close-btn {
            position: absolute;
           top: 0.9em;
            right: 0.9em;
            background: var(--btn-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
           font-size: 1.4rem;
            cursor: pointer;
            padding: 0.3em 0.6em;
           border-radius: 6px;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }

         .preview-container .close-btn:hover {
            background-color: var(--accent-color);
             color: var(--bg-color);
             box-shadow: 0 0 10px var(--glow-color);
        }

        .preview-container .fullScreen-btn {
            position: absolute;
              top: 0.9em;
            left: 0.9em;
            background: var(--btn-bg);
            border: 1px solid var(--accent-color);
           color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 0.3em 0.6em;
           border-radius: 6px;
             transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }

        .preview-container .fullScreen-btn:hover {
            background-color: var(--accent-color);
             color: var(--bg-color);
            box-shadow: 0 0 10px var(--glow-color);
         }

        footer {
            background-color: var(--header-bg);
             text-align: center;
            padding: 1em;
            font-size: 0.9rem;
             box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.6);
             border-top: 1px solid var(--accent-color);
        }

        footer span {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .chatbox-toggle {
            position: fixed;
             bottom: 1.25em;
            right: 1.25em;
             background: var(--accent-color);
            border: none;
            color: var(--bg-color);
             font-size: 1.3rem;
             padding: 1em;
            border-radius: 50%;
            cursor: pointer;
             z-index: 1001;
            transition: transform 0.3s, box-shadow 0.3s;
             box-shadow: 0 0 10px var(--glow-color);
        }

        .chatbox-toggle:hover {
             transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-color);
        }

        .chat-popup {
             position: fixed;
             bottom: 5em;
            right: 1.25em;
            background: var(--header-bg);
             color: var(--text-color);
             border-radius: 12px;
            box-shadow: 0 0 10px var(--glow-color);
            max-height: 25em;
           width: 18.75em;
            display: none;
            flex-direction: column;
            z-index: 1000;
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0;
             transform: translateY(20px);
        }

        .chat-popup.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
         }

        .chat-header {
            display: flex;
            justify-content: space-between;
            padding: 0.75em;
             border-bottom: 1px solid var(--accent-color);
            font-weight: 500;
        }

         .chat-header .close-chat {
            cursor: pointer;
            color: var(--accent-color);
             font-size: 1.3rem;
             transition: color 0.3s;
        }

        .chat-header .close-chat:hover {
            color: var(--text-color);
         }


        .chat-header .reset-chat {
             cursor: pointer;
            color: var(--accent-color);
            font-size: 1.3rem;
           transition: color 0.3s;
             margin-right: 10px;
         }

         .chat-header .reset-chat:hover {
            color: var(--text-color);
        }

         .chat-messages {
            padding: 0.75em;
            overflow-y: auto;
            flex: 1;
        }

        .chat-message {
            padding: 0.75em;
             margin-bottom: 0.75em;
           border-radius: 10px;
            word-wrap: break-word;
            max-width: 80%;
            transition: all 0.3s;
             position: relative;
            /* Add this to position buttons */
        }

        .chat-message.user-message {
            background: var(--btn-bg);
             align-self: flex-end;
            border: 1px solid var(--accent-color);
         }

        .chat-message.user-message .edit-btn {
            position: absolute;
             top: 8px;
            right: 35px;
            display: none;
             background: none;
            border: none;
             color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
             transition: color 0.3s
        }

         .chat-message.user-message:hover .edit-btn {
             display: block;
         }

         .chat-message.user-message .edit-btn:hover {
             color: var(--accent-color);
        }


        .chat-message.user-message .copy-btn {
            position: absolute;
           top: 8px;
            right: 8px;
             display: none;
            background: none;
           border: none;
            color: var(--text-color);
           font-size: 1.1rem;
           cursor: pointer;
            transition: color 0.3s;
        }

        .chat-message.user-message:hover .copy-btn {
           display: block;
         }

         .chat-message.user-message .copy-btn:hover {
            color: var(--accent-color);
         }

        .chat-message.bot-message {
            background: var(--editor-bg);
             align-self: flex-start;
            border: 1px solid var(--accent-color);
            position: relative;
        }

        .chat-message.bot-message .copy-btn {
            position: absolute;
            top: 8px;
             right: 8px;
             display: none;
           background: none;
            border: none;
           color: var(--text-color);
            font-size: 1.1rem;
             cursor: pointer;
            transition: color 0.3s;
        }

         .chat-message.bot-message:hover .copy-btn {
            display: block;
        }

        .chat-message.bot-message .copy-btn:hover {
           color: var(--accent-color);
       }

        .chat-message.bot-message pre {
            white-space: pre-wrap;
             margin: 0.5em 0;
            font-family: monospace;
            background: rgba(0, 0, 0, 0.2);
             padding: 0.6em;
             border-radius: 8px;
            overflow-x: auto;
        }

        .chat-input-area {
            display: flex;
             padding: 0.75em;
            border-top: 1px solid var(--accent-color);
           align-items: center;
        }

        .chat-input-area textarea {
           flex: 1;
            resize: none;
             background: none;
           color: var(--text-color);
             padding: 0.6em;
            border: 1px solid var(--accent-color);
             border-radius: 8px;
            font-size: 1em;
             min-height: 2.2em;
           outline: none;
         }

         .chat-input-area textarea::placeholder {
             color: var(--text-muted);
        }

         .chat-input-area button {
             background: var(--accent-color);
             border: none;
            color: var(--bg-color);
            cursor: pointer;
             font-size: 1.3rem;
            padding: 0.6em;
            border-radius: 8px;
            margin-left: 0.6em;
             transition:
                                background-color 0.3s, box-shadow 0.3s;
        }

        .chat-input-area button:hover {
            background-color: #00cc77;
            box-shadow: 0 0 10px var(--glow-color);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;             align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .loading-overlay.active {
            display: flex;
        }

        .circular-loader {
            width: 2.8em;
            height: 2.8em;
            border-radius: 50%;
            border: 5px solid var(--accent-color);
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        .segregation-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 0.5em;
            border-radius: 6px;
            transition: all 0.3s, color 0.3s;
            position: relative;
        }

        .segregation-toggle:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }


        .segregation-toggle.active {
            color: var(--accent-color);
        }

        .segregation-toggle:hover {
            color: var(--accent-color);
        }

        .segregation-toggle .tooltiptext {
            visibility: hidden;
            width: auto;
            background-color: var(--btn-bg);
            color: var(--text-color);
            text-align: center;
            padding: 5px 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .custom-prompt-toggle {
           background: var(--btn-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
            font-size: 1rem;
            cursor: pointer;
           padding: 0.5em 0.8em;
            border-radius: 6px;
             transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
             position: relative;
            overflow: hidden;
            /* Ensures the zipper icon stays inside the button */
        }

          .custom-prompt-toggle:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
             box-shadow: 0 0 10px var(--glow-color);
          }

          .custom-prompt-toggle.active {
            background: var(--accent-color);
            color: var(--bg-color);
            box-shadow: 0 0 10px var(--glow-color);
        }
         .custom-prompt-toggle i {
                transition: transform 0.3s ease;
                 display: inline-block;
            }

           .custom-prompt-toggle.active i {
            transform: rotate(180deg);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg)
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Add dropdown styles */
        .system-prompt-dropdown {
            position: relative;
        }

        .system-prompt-dropdown select {
            background: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 0.5em;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        /* Media Queries for Responsiveness */
        @media (min-width: 768px) {
            /* Tablets and larger */
            :root {
                font-size: 17px;
                /* Increased base font size for larger screens */
            }
            main {
                flex-direction: row;
                /* Switch to row on larger screens */
            }
            .editor-container {
                width: 70%;
            }
            .preview-container {
                width: 30%;
                margin-top: 0;
                border-left: 2px solid var(--border-color);
                /* Added border for separation on large screens */
            }
        }

        @media (min-width: 1024px) {
            :root {
                font-size: 18px;
                /* Increased base font size for larger screens */
            }
        }

        @media (min-width: 1200px) {
            :root {
                font-size: 19px;
                /* Increased base font size for larger screens */
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <h1>Codefusion</h1>
        <div class="controls">
            <!-- System Prompt Dropdown -->
            <div class="system-prompt-dropdown">
                <select id="system-prompt-select">
                    <option value="default">Default Assistant</option>
                    <option value="code-explainer">Code Explainer</option>
                    <option value="bug-finder">Bug Finder</option>
                    <option value="performance-optimizer">Performance Optimizer</option>
                    <option value="custom">Custom Prompt</option>
                </select>
                <div style="display: flex; align-items: center; margin-top:0.3em">
                    <textarea id="custom-prompt" style="display: none; margin-right: 0.3em" placeholder="Enter your custom system instruction"></textarea>
                    <button id="custom-prompt-toggle" class="custom-prompt-toggle"><i class="fas fa-lock"></i></button>
                </div>
            </div>
            <div class="dropdown">
                <button class="toggle">
                    <i class="fas fa-key"></i>
                    <span class="tooltiptext">API Key</span>
                </button>
                <input type="password" placeholder="Enter Security Code" id="security-code">
            </div>
            
            <button id="download-btn">
                <i class="fas fa-download"></i>
                 <span class="tooltiptext">Download</span>
            </button>
            <button id="segregation-btn"  >
                <i class="fas fa-code-branch"></i>
                 <span class="tooltiptext">Segregation</span>
            </button>
            <button id="theme-toggle" >
                <i class="fas fa-sun"></i>
                 <span class="tooltiptext">Theme</span>
            </button>
            <button id="feedback-btn" onclick="sendFeedback()">
                <i class="fas fa-envelope"></i>
                  <span class="tooltiptext">Feedback</span>
            </button>
            <button id="reset-btn" >
                <i class="fas fa-sync"></i>
                 <span class="tooltiptext">Reset</span>
            </button>
            <button id="toggle-preview" >
                <i class="fas fa-eye"></i>
                <span class="tooltiptext">Preview</span>
            </button>
            <button id="toggle-buttons">
              <i class="fas fa-bars"></i>
              <span class="tooltiptext">Toggle Button</span>
            </button>

        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="editor-container">
            <textarea id="html-editor" placeholder="Write HTML here..."></textarea>
            <textarea id="css-editor" placeholder="Write CSS here..."></textarea>
            <textarea id="js-editor" placeholder="Write JavaScript here..."></textarea>
        </div>
        <div class="preview-container">
            <button class="fullScreen-btn">
                <i class="fas fa-expand"></i>
            </button>
            <button class="close-btn">×</button>
            <iframe id="preview-frame"></iframe>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <span>Codefusion - Your Dream App, Live in 5!</span>
    </footer>

    <!-- Chat Toggle -->
    <button class="chatbox-toggle">
        <i class="fas fa-comment-dots"></i>
    </button>

    <!-- Chat Popup -->
    <div class="chat-popup">
        <div class="chat-header">
            <span>Codefusion AI Assistant</span>
            <span class="reset-chat">
                <i class="fas fa-trash"></i>
            </span>
            <span class="close-chat">×</span>
        </div>
        <div class="chat-messages"></div>
        <div class="chat-input-area">
            <textarea placeholder="Type your message..."></textarea>
            <button>
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        <div class="loading-overlay">
            <div class="circular-loader"></div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification"></div>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const body = document.body;
        const htmlEditor = document.getElementById('html-editor');
        const cssEditor = document.getElementById('css-editor');
        const jsEditor = document.getElementById('js-editor');
        const previewFrame = document.getElementById('preview-frame');
        const togglePreviewBtn = document.getElementById('toggle-preview');
        const resetBtn = document.getElementById('reset-btn');
        const closeBtn = document.querySelector('.close-btn');
        const fullScreenBtn = document.querySelector('.fullScreen-btn');
        const segregationBtn = document.getElementById('segregation-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const securityCodeInput = document.getElementById('security-code');
        const dropdownToggle = document.querySelector('.dropdown .toggle');
        const chatboxToggle = document.querySelector('.chatbox-toggle');
        const chatPopup = document.querySelector('.chat-popup');
        const closeChatBtn = document.querySelector('.chat-header .close-chat');
        const resetChatBtn = document.querySelector('.chat-header .reset-chat');
        const chatMessages = document.querySelector('.chat-messages');
        const chatInput = document.querySelector('.chat-input-area textarea');
        const chatSendBtn = document.querySelector('.chat-input-area button');
        const loadingOverlay = document.querySelector('.loading-overlay');
        const notification = document.querySelector('.notification');
        const systemPromptSelect = document.getElementById('system-prompt-select');
        const customPromptTextarea = document.getElementById('custom-prompt');
        const customPromptToggle = document.getElementById('custom-prompt-toggle');
        const toggleButtonsBtn = document.getElementById('toggle-buttons')
         const downloadBtn = document.getElementById('download-btn');

        let defaultPrompt = `You are an AI assistant named Cody, specializing in helping developers write, debug, and optimize code with precision and efficiency. You empower users to interact seamlessly with their codebase, offering advanced capabilities for auto-completion, error detection, refactoring, and generating boilerplate code. Your expertise lies in transforming ideas into well-structured, maintainable, and efficient code tailored to the user's project requirements.`;
        let codeExplainerPrompt = `You are a code explainer bot. You break down code snippets and explain each line in detail to the user, and provide a general summary of how the entire code works.`;
        let bugFinderPrompt = `You are an ai bug finder. Your sole function is to analyze the provided code and find any bugs or errors, and then output the fixed code.`;
        let performanceOptimizerPrompt = `You are an AI performance optimizer. Your goal is to optimize code for speed, minimal resource consumption, and overall efficiency.`
        let currentPrompt = defaultPrompt;
        let apiKey = "";
        let isSegregationActive = false;
        let isDarkMode = true;
        let customPromptActive = false;
          let buttonsVisible = true;

        function sendFeedback() {
            window.location.href = 'mailto:Flynnpontino@gmail.com?subject=Codefusion Feedback';
        }

        function updatePreview() {
            let htmlCode = htmlEditor.value;
            if (isSegregationActive) {
                htmlCode = segregateCode();
            }
            const css = `<style>${cssEditor.value}</style>`;
            const js = `<script>${jsEditor.value}<\/script>`;
            previewFrame.srcdoc = `${htmlCode}${css}${js}`;
            showNotification('Preview Updated', 'success');
        }

        function togglePreview() {
            const previewContainer = previewFrame.parentElement;
            if (previewContainer.classList.contains('fullscreen')) {
                previewContainer.classList.remove('fullscreen')
                fullScreenBtn.innerHTML = `<i class="fas fa-expand"></i>`
                showNotification('Preview exit full screen', 'success');
            } else {
                previewContainer.classList.add('fullscreen')
                fullScreenBtn.innerHTML = `<i class="fas fa-compress"></i>`
                showNotification('Preview enter full screen', 'success');
            }
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            body.classList.toggle('light-theme', !isDarkMode);
            themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            showNotification(isDarkMode ? 'Dark theme enabled' : 'Light theme enabled', 'success');
        }

        function resetEditors() {
            htmlEditor.value = '';
            cssEditor.value = '';
            jsEditor.value = '';
            previewFrame.srcdoc = '';
            showNotification('Editors Reset', 'success');
        }

        function showCopyNotification(message) {
            notification.textContent = message;
            notification.classList.add('active', 'copy');
            setTimeout(() => {
                notification.classList.remove('active', 'copy');
            }, 1500);
        }

        function showNotification(message, type = '') {
            notification.textContent = message;
            notification.classList.add('active');
            if (type === 'success') {
                notification.classList.add('success');
            }

            setTimeout(() => {
                notification.classList.remove('active');
                notification.classList.remove('success');
            }, 3000);
        }

        function segregateCode() {
            const code = htmlEditor.value;
            if (!code) return consoleOutput.innerHTML = `No HTML code detected.`;

            let segregatedHTML = "";
            let segregatedCSS = "";
            let segregatedJS = "";

            // Extract HTML outside script and style tags
            segregatedHTML = code.replace(/<script[\s\S]*?<\/script>/gi, '').replace(/<style[\s\S]*?<\/style>/gi, '').trim();

            // Extract JavaScript inside script tags
            const scriptMatches = code.matchAll(/<script>([\s\S]*?)<\/script>/gi);
            for (const match of scriptMatches) {
                segregatedJS += match[1].trim() + '\n';
            }

            // Extract CSS inside style tags
            const styleMatches = code.matchAll(/<style>([\s\S]*?)<\/style>/gi);
            for (const match of styleMatches) {
                segregatedCSS += match[1].trim() + '\n';
            }
            htmlEditor.value = segregatedHTML.trim();
            cssEditor.value = segregatedCSS.trim();
            jsEditor.value = segregatedJS.trim();
            return htmlEditor.value;
        }

       function downloadCode() {
            const zip = new JSZip();

            // Get code from editors
            const htmlCode = htmlEditor.value;
            const cssCode = cssEditor.value;
            const jsCode = jsEditor.value;


             //  Add files to zip
            zip.file("index.html", htmlCode);
            zip.file("styles.css", cssCode);
            zip.file("scripts.js", jsCode);

            //  Create the README
            const readmeContent = `
# Codefusion Project

This is a project downloaded from Codefusion.

## Contents:

- **index.html:** The main HTML file.
- **styles.css:** The CSS file.
- **scripts.js:** The JavaScript file.

## Usage

Open the index.html file in a web browser to view the project.

## Notes:

-   If segregation is active the HTML file might include inline code for the CSS or JS.
-   This download is made possible by Codefusion.

`;
            zip.file("README.md", readmeContent);
            // Generate zip and create download link
            zip.generateAsync({ type: "blob" }).then(function(content) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = 'codefusion_project.zip';
                link.click();
                 showNotification('Code downloaded', 'success');
            });
        }
        
        resetBtn.addEventListener('click', resetEditors);
        togglePreviewBtn.addEventListener('click', () => {
            previewFrame.parentElement.style.display = previewFrame.parentElement.style.display === 'none' ? 'block' : 'none';
            showNotification('Preview Toggled', 'success');
        });

        closeBtn.addEventListener('click', () => {
            previewFrame.parentElement.style.display = 'none';
            showNotification('Preview Closed', 'success');
        });

        fullScreenBtn.addEventListener('click', togglePreview);

        themeToggle.addEventListener('click', toggleTheme);

        segregationBtn.addEventListener('click', () => {
            isSegregationActive = !isSegregationActive;
            segregationBtn.classList.toggle('active', isSegregationActive);
            if (isSegregationActive) {
                showNotification('HTML segregation active', 'success');
            } else {
                showNotification('HTML segregation inactive', 'success');
            }
            updatePreview();
        });
        
        downloadBtn.addEventListener('click', downloadCode);

        dropdownToggle.addEventListener('click', () => {
            securityCodeInput.style.display = securityCodeInput.style.display === 'none' ? 'block' : 'none';
        });

        securityCodeInput.addEventListener('input', () => {
            if (securityCodeInput.value === '123456') {
                apiKey = 'AIzaSyB4ugVm-HR9SL4dxAhk-FoAkczkOu1NqGo';
                // Injected API Key
                showNotification('API Key Injected', 'success');
                securityCodeInput.value = '';
                securityCodeInput.style.display = 'none';
            }
        });

        htmlEditor.addEventListener('input', updatePreview);
        cssEditor.addEventListener('input', updatePreview);
        jsEditor.addEventListener('input', updatePreview);

        // ChatBox
        chatboxToggle.addEventListener('click', () => {
            chatPopup.classList.toggle('active');
        });

        closeChatBtn.addEventListener('click', () => {
            chatPopup.classList.remove('active');
        });

        resetChatBtn.addEventListener('click', () => {
            chatMessages.innerHTML = '';
            showNotification("Chat history cleared!", 'success');
        })

        chatSendBtn.addEventListener('click', sendMessage);

        chatInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        });

        systemPromptSelect.addEventListener('change', function() {
            const selectedValue = systemPromptSelect.value;
            if (selectedValue === 'default') {
                currentPrompt = defaultPrompt;
                customPromptTextarea.style.display = 'none';
                customPromptToggle.style.display = 'none'
                showNotification('Default AI assistant', 'success');
            } else if (selectedValue === 'code-explainer') {
                currentPrompt = codeExplainerPrompt;
                customPromptTextarea.style.display = 'none';
                customPromptToggle.style.display = 'none'
                showNotification('Code explainer bot', 'success');
            } else if (selectedValue === 'bug-finder') {
                currentPrompt = bugFinderPrompt;
                customPromptTextarea.style.display = 'none';
                customPromptToggle.style.display = 'none'
                showNotification('Bug finder bot', 'success');
            } else if (selectedValue === 'performance-optimizer') {
                currentPrompt = performanceOptimizerPrompt;
                customPromptTextarea.style.display = 'none';
                customPromptToggle.style.display = 'none'
                showNotification('Performance optimizer bot', 'success');
            } else if (selectedValue === 'custom') {
                customPromptTextarea.style.display = 'block';
                customPromptToggle.style.display = 'inline-block'
                if (customPromptActive) {
                    currentPrompt = customPromptTextarea.value;
                    showNotification('Custom prompt active', 'success');
                } else {
                    showNotification('Custom prompt inactive, click activate to use', 'success');
                }
            }
        });

        customPromptTextarea.addEventListener('input', function() {
            if (systemPromptSelect.value === 'custom' && customPromptActive) {
                currentPrompt = customPromptTextarea.value;
            }
        });

           customPromptToggle.addEventListener('click', () => {
            customPromptActive = !customPromptActive;
            customPromptToggle.classList.toggle('active', customPromptActive);
             customPromptToggle.querySelector('i').classList.toggle('fa-lock',!customPromptActive)
               customPromptToggle.querySelector('i').classList.toggle('fa-unlock',customPromptActive)
            if (customPromptActive) {
                 showNotification('Custom prompt active', 'success');
            } else {
                  showNotification('Custom prompt inactive', 'success');
            }
        });
        toggleButtonsBtn.addEventListener('click',() => {
               buttonsVisible = !buttonsVisible;
                 const buttonList = document.querySelectorAll('header .controls > button:not(#toggle-buttons)');
                 buttonList.forEach(button => {
                  button.style.display = buttonsVisible ? 'inline-block' : 'none';
                 });
           });



        async function sendMessage(editedMessage = null, messageElement = null) {
            let message = editedMessage ? editedMessage : chatInput.value.trim();
            if (!message) return;
            addMessage(message, true, messageElement);
            if (!editedMessage) {
                chatInput.value = "";
            }

            loadingOverlay.classList.add('active');

            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `${currentPrompt} ${message} If the user asked for a code, give it in the appropriate language like html or plaintext, do not create a preview. if code was not asked for, answer accordingly.`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    console.error(`API request failed with status ${response.status}`);
                    const errorData = await response.json();
                    console.error("API error details:", errorData);
                    addMessage(`Error: Could not get response from Codefusion AI`, false);
                    loadingOverlay.classList.remove('active');
                    return;
                }

                const data = await response.json();
                loadingOverlay.classList.remove('active');
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0].text) {
                    let responseText = data.candidates[0].content.parts[0].text.trim();
                    addMessage(responseText, false);
                } else {
                    console.error("No response text found in data:", data);
                    addMessage(`Error: No response from Codefusion AI`, false);
                }
            } catch (error) {
                console.error("Error during API request:", error);
                addMessage(`Error: ${error}`, false);
                loadingOverlay.classList.remove('active');
            }
        }

        function addMessage(content, isUser, messageElement = null) {
            const message = document.createElement('div');
            message.classList.add('chat-message', isUser ? 'user-message' : 'bot-message');
            if (isUser) {
                message.innerHTML = `${content}
                    <button class="edit-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="copy-btn"><i class="fas fa-copy"></i></button>
                `;
            } else {
                let messageContent = content;
                let codeSnippet = null;
                const codeMatch = messageContent.match(/```([\w-]+)?\s*([\s\S]*?)```/);

                if (codeMatch) {
                    codeSnippet = `<pre><code class="language-${codeMatch[1] || 'plaintext'}">${codeMatch[2].trim()}</code></pre>`;
                    messageContent = messageContent.replace(codeMatch[0], "").trim();
                }

                message.innerHTML = `
                    ${messageContent}
                    ${codeSnippet || ""}
                    <button class="copy-btn"><i class="fas fa-copy"></i></button>
                `;
            }

            if (messageElement) {
                chatMessages.replaceChild(message, messageElement);
            } else {
                chatMessages.appendChild(message);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            if (!isUser) {
                const copyButton = message.querySelector('.copy-btn');
                if (copyButton) {
                    copyButton.addEventListener('click', () => {
                        copyBotMessage(message);
                    });
                }
            }
            if (isUser) {
                const copyButton = message.querySelector('.copy-btn');
                if (copyButton) {
                    copyButton.addEventListener('click', () => {
                        copyUserMessage(message);
                    });
                }
                const editButton = message.querySelector('.edit-btn');
                if (editButton) {
                    editButton.addEventListener('click', () => {
                        editUserMessage(message);
                    })
                }
            }
        }

        function copyBotMessage(messageElement) {
            const codeBlock = messageElement.querySelector('pre code');
            const textContent = messageElement.firstChild.textContent;

            const code = codeBlock ? codeBlock.textContent : null;
            const combined = code ? textContent + "\n" + code : textContent;
            navigator.clipboard.writeText(combined).then(() => {
                showCopyNotification("Copied to Clipboard!");
            }).catch(err => console.error("Error copying:", err));
        }

        function copyUserMessage(messageElement) {
            const textContent = messageElement.firstChild.textContent;
            navigator.clipboard.writeText(textContent).then(() => {
                showCopyNotification("Copied to Clipboard!");
            }).catch(err => console.error("Error copying:", err));
        }

        function editUserMessage(messageElement) {
            const textContent = messageElement.firstChild.textContent;
            chatInput.value = textContent
            chatMessages.removeChild(messageElement);
        }
    </script>
</body>

</html>
