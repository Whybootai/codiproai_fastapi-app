<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodyPro AI Assistant</title>
    <style>
        :root {
            --primary: #00ff9d;
            --secondary: #1a73e8;
            --accent: #ff5722;
            --dark: #0b0f14;
            --light: #e8f1f2;
            --bg: #0b0f14;
            --text-color: #e8f1f2;
        }

        body {
            background: var(--bg);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        header {
            width: 100%;
            padding: 20px;
            text-align: center;
             position: relative;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            top: 0;
            z-index: 1000;
          overflow: hidden;
        }

        header h1 {
            margin: 0;
            font-size: 2em;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
         #google-drive-icon {
           position: absolute;
            top: 20px;
             right: 60px;
            cursor: pointer;
            font-size: 1.8em;
           color: var(--light);
            transition: color 0.3s ease;
        }
         #google-drive-icon:hover {
            color: var(--primary);
         }
          #user-guide-icon {
            position: absolute;
             top: 20px;
              right: 20px;
             cursor: pointer;
             font-size: 1.8em;
             color: var(--light);
              transition: color 0.3s ease;
        }
        #user-guide-icon:hover {
           color: var(--primary);
        }
        /* Marquee Styles */
        .marquee-container {
             width: 100%;
             position: absolute;
              bottom: 0;
            overflow: hidden;
              background: rgba(255, 255, 255, 0.1);
             padding: 5px 0;
        }

        .marquee-text {
            display: inline-block;
             white-space: nowrap;
            animation: marquee 20s linear infinite;
              color: var(--light);
        }

        @keyframes marquee {
          0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        #chat-container {
            width: 90%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            padding: 30px;
            box-shadow: 0 0 40px rgba(0, 255, 157, 0.1);
            display: flex;
            flex-direction: column;
            margin: 30px 0;
        }

        #messages {
            height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2);
        }

        .message {
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            line-height: 1.5;
            animation: slideIn 0.3s ease;
            width: fit-content;
            max-width: 90%;
            position: relative;
        }

        .message-options {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none; /* Hidden by default */
        }

        .message:hover .message-options {
            display: flex;
        }

        .message-options button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            font-size: 1.1em;
            padding: 2px 5px;
        }

        .message-options button:hover {
            color: var(--primary)
        }

        .message img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            object-fit: cover;
        }

        .user-message {
            background: rgba(0, 255, 157, 0.1);
            border-left: 4px solid var(--primary);
            align-self: flex-end;
        }

        .bot-message {
            background: rgba(255, 255, 255, 0.1);
            border-right: 4px solid var(--secondary);
            align-self: flex-start;
        }

        .bot-message ul, .bot-message ol {
            margin-top: 10px;
            margin-bottom: 10px;
            padding-left: 30px; /* Add padding for list indentation */
        }
        .bot-message li {
             line-height: 1.6;
         }

        .bot-message pre {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }

        .bot-message code {
            font-family: monospace;
        }

        #input-container {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        select,
        textarea {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            color: var(--light);
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.2);
             resize: vertical;
            min-height: 50px;
        }

        select:focus,
        textarea:focus {
            outline: none;
            box-shadow: 0 0 15px var(--primary);
        }

        button {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            background: var(--primary);
            color: var(--dark);
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            font-size: 1rem;
        }
          #clear-chat-button {
           margin-top: 10px;
            background: var(--accent);
            color: var(--light);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 255, 157, 0.4);
        }

         #prompt-suggestions {
           display: flex;
             flex-wrap: wrap;
              gap: 10px;
            margin-top: 10px;
             justify-content: center;
        }

        .prompt-suggestion {
          background: rgba(255,255,255,0.1);
          padding: 10px 15px;
           border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
         .prompt-suggestion:hover{
            background-color: rgba(255,255,255,0.2);
         }
        .thinking {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .dot {
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 0.6s infinite ease-in-out;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9em;
            color: var(--light);
            opacity: 0.7;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        #api-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        #api-modal .modal-content {
            background: var(--dark);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.5);
            text-align: center;
            color: var(--light);
        }

        #api-modal .modal-content input {
            width: 80%;
            padding: 10px;
            border: none;
            border-radius: 10px;
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        #api-modal .modal-content button {
            margin-top: 20px;
        }

        /* Sidebar Styles */
         .sidebar {
            position: fixed;
            top: 0;
            left: -300px; /* Start off screen on the left */
            width: 300px;
            height: 100%;
            background: var(--secondary);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2); /* Shadow on the right side */
            transition: left 0.3s ease; /* Transition the left property */
            padding: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0; /* Slide in from the left */
         }

        .sidebar-button {
             position: fixed;
            top: 20px;
            left: 20px; /* Position the button on the left */
            padding: 10px;
            background: var(--primary);
            border-radius: 50%;
            color: var(--dark);
            cursor: pointer;
            transition: left 0.3s ease; /* Transition the left property */
            z-index: 1002;
        }

        .sidebar-button.open {
           left: 320px;
         }

        .sidebar-button i {
            font-size: 1.2em;
        }

        .profile-upload {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .profile-upload label {
            background-color: var(--primary);
            color: var(--dark);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

         #user-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: contain;
             margin-bottom: 10px;
            border: 2px solid var(--accent);
        }

        .sidebar-option {
            margin: 10px 0;
            padding: 8px;
            border-radius: 5px;
            color: var(--light);
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .sidebar-option:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Settings section */
        .settings-section {
            margin: 20px 0;
            padding: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-section h3 {
            margin-bottom: 10px;
        }

        .settings-section .setting-item {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
        }

        .settings-section .setting-item label {
            display: block;
            margin-bottom: 5px;
        }

        .settings-section .setting-item input[type="color"],
        .settings-section .setting-item select,
        .settings-section .setting-item input[type="text"],
        .settings-section .setting-item input[type="range"] {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 5px;
            color: var(--light);
            padding: 8px;
            width: 100%;
        }

        .settings-section .setting-item .radio-group {
            display: flex;
            align-items: center;
        }

        .settings-section .setting-item .radio-group label {
            display: inline-flex;
            align-items: center;
            margin: 0 15px 0 0;
        }

        .settings-section .setting-item .radio-group input[type="radio"] {
            margin-right: 5px;
        }

        .settings-section #preview {
            margin: 10px auto;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            text-align: center;
        }

        .settings-section #preview img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            #chat-container {
                width: 95%;
                padding: 20px;
            }

            #messages {
                height: 400px;
                padding: 15px;
            }

            .message {
                font-size: 0.9rem;
            }

            #input-container {
                flex-direction: column;
                align-items: stretch;
            }

            select,
            textarea,
            button {
                margin-bottom: 10px;
                width: 100%;
            }

             .sidebar-button {
                 left: 10px;
             }

             .sidebar-button.open {
                 left: 310px;
             }

            .sidebar {
                width: 280px;
            }
        }
        /* User Guide Popup */
         #user-guide-popup {
            position: fixed;
           top: 25%;
             left: 25%;
            width: 50%;
           height: 50%;
            background: rgba(0, 0, 0, 0.8);
             border-radius: 15px;
             color: var(--light);
           padding: 30px;
            z-index: 10000;
            display: none;
            overflow-y: auto; /* Enable scrolling for long instructions */
            box-shadow: 0 0 40px rgba(0, 255, 157, 0.2);
         }
          #user-guide-popup.active {
             display: block;
         }
         #user-guide-popup .close-button {
             position: absolute;
            top: 10px;
            right: 10px;
           font-size: 1.5em;
            cursor: pointer;
             color: var(--accent);
            transition: color 0.3s ease;
        }
        #user-guide-popup .close-button:hover {
            color: var(--primary);
        }
        #user-guide-popup h2 {
           margin-bottom: 20px;
          text-align: center;
        }
        #user-guide-popup ul {
           padding-left: 30px;
        }
        #user-guide-popup li {
           margin-bottom: 10px;
           line-height: 1.5;
         }
          #copy-notification {
            position: fixed;
           bottom: 20px;
             right: 20px;
            background-color: rgba(0, 255, 157, 0.8); /* Primary color for notification */
            color: var(--dark);
           padding: 10px 15px;
            border-radius: 5px;
            opacity: 0; /* Start invisible */
           transition: opacity 0.3s ease; /* Smooth opacity transition */
             pointer-events: none; /* Ensure it doesn't interfere with clicking */
           z-index: 10000
         }
          #copy-notification.show {
            opacity: 1; /* Make it visible */
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <div id="api-modal">
        <div class="modal-content">
            <h2>Enter API Key</h2>
            <input type="text" id="api-key-input" placeholder="Your API Key...">
            <button onclick="submitApiKey()">Submit</button>
        </div>
    </div>

    <header>
        <h1>CodyPro AI</h1>
        <i class="fab fa-google-drive" id="google-drive-icon" onclick="saveChatToDrive()"></i>
         <i class="fas fa-question-circle" id="user-guide-icon" onclick="toggleUserGuide()"></i>
        <div class="marquee-container">
            <div class="marquee-text">
                Select your prompt type, input your prompt, and let CodyPro AI assist you! | CodyPro AI may make mistakes, kindly double-check the output provided. | Created with ❤️ by Flynn James P.
            </div>
        </div>
    </header>
    <div id="user-guide-popup">
        <span class="close-button" onclick="toggleUserGuide()">×</span>
         <h2>How to Use CodyPro AI</h2>
        <ul>
            <li><strong>Select Prompt Type:</strong> Use the dropdown menu to select your prompt type such as "Chat," "List Generation," "Image Generation", etc.</li>
             <li><strong>Type Your Prompt:</strong> Use the text input to type your prompt, including details of what you want CodyPro AI to do for you.</li>
            <li><strong>Clickable Prompt Suggestions:</strong> Use the provided suggestions below the text input to know what type of requests you can make CodyPro AI.</li>
             <li><strong>Click Send:</strong> Click the Send button to submit your prompt and receive CodyPro AI's response.</li>
             <li><strong>Edit and Copy Messages:</strong> Hover over your chat bubbles to edit or copy your or CodyPro AI messages.</li>
             <li><strong>Save To Google Drive:</strong> Click the Google Drive icon on the top right to save your chat log.</li>
             <li><strong>Settings:</strong> Click the setting icon in the bottom left to adjust CodyPro AI's theme, look, or feel.</li>
             <li><strong>Clear Chat:</strong> Click on the clear chat button to restart your conversation with CodyPro AI.</li>
        </ul>
    </div>
    <div id="chat-container">
        <main id="messages" aria-live="polite"></main>
        <div id="input-container">
            <select id="prompt-type" aria-label="Select Prompt Type">
                <option value="chat">Chat</option>
                <option value="list">List Generation</option>
                 <option value="scrape">Scrape Page</option>
                 <option value="crawl">Crawl Page</option>
                <option value="image">Image Generation</option>
                <option value="code">Code Generation</option>
                <option value="data">Data Generation</option>
            </select>
            <textarea id="training-input" placeholder="Type your prompt..." aria-label="Input Prompt Field"></textarea>
            <div>
                 <button onclick="sendTrainingPrompt()" aria-label="Send Prompt">Send</button>
                 <button onclick="clearChat()" id="clear-chat-button" aria-label="Clear Chat">Clear Chat</button>
            </div>
        </div>
        <div id="prompt-suggestions">
           <div class="prompt-suggestion" onclick="setPrompt('Give me a list of the top 5 research papers related to Artificial intelligence.')">Top research papers on AI</div>
            <div class="prompt-suggestion" onclick="setPrompt('Write an email to a client to request feedback.')">Email feedback request</div>
            <div class="prompt-suggestion" onclick="setPrompt('Create a project plan for a mobile app development.')">Project plan mobile app dev</div>
             <div class="prompt-suggestion" onclick="setPrompt('Create a python code to do quick sort.')">Python code quick sort</div>
           <div class="prompt-suggestion" onclick="setPrompt('Scrape the text from https://www.example.com')">Scrape example.com</div>
           <div class="prompt-suggestion" onclick="setPrompt('Crawl the links from https://www.example.com')">Crawl example.com</div>
       </div>
        <footer>
            © 2025 <a href="#">CodyPro AI</a>. Built with ❤️ by Flynn James P.
        </footer>
    </div>
    <!-- Sidebar -->
    <div class="sidebar" id="settingsSidebar">
        <div class="profile-upload">
             <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='#e0e0e0'/><text x='50' y='65' font-size='48' text-anchor='middle' fill='#0b0f14' font-family='Arial, sans-serif'>CP</text></svg>" alt="User Profile" id="user-image" style="object-fit: contain;"/>
            <label for="profile-upload-input">Upload Profile Image</label>
            <input type="file" id="profile-upload-input" accept="image/*" style="display: none;"/>
        </div>
        <div class="settings-section">
            <h3>Theme Settings</h3>
            <div class="setting-item">
                <label for="theme-mode">Theme Mode:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="theme-mode" value="light" onchange="applyTheme(this.value)"> Light
                    </label>
                    <label>
                        <input type="radio" name="theme-mode" value="dark" checked onchange="applyTheme(this.value)"> Dark
                    </label>
                    <label>
                        <input type="radio" name="theme-mode" value="system" onchange="applyTheme(this.value)"> System
                    </label>
                </div>
            </div>
            <div class="setting-item">
                <label for="primary-color">Primary Color:</label>
                <input type="color" id="primary-color" value="#00ff9d" onchange="applyPrimaryColor(this.value)">
            </div>
            <div class="setting-item">
                <label for="accent-color">Accent Color:</label>
                <input type="color" id="accent-color" value="#ff5722" onchange="applyAccentColor(this.value)">
            </div>
            <div class="setting-item">
                <label for="background-color">Background Color:</label>
                <input type="color" id="background-color" value="#0b0f14" onchange="applyBackgroundColor(this.value)">
            </div>
        </div>
        <div class="settings-section">
            <h3>Chat Interface</h3>
            <div class="setting-item">
                <label for="bubble-style">Message Bubble Style:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="bubble-style" value="rounded" checked onchange="applyBubbleStyle(this.value)">
                        Rounded
                    </label>
                    <label>
                        <input type="radio" name="bubble-style" value="square" onchange="applyBubbleStyle(this.value)">
                        Square
                    </label>
                </div>
            </div>
            <div class="setting-item">
                <label for="bubble-color">Bubble Color (User):</label>
                <input type="color" id="user-bubble-color" value="rgba(0, 255, 157, 0.1)"
                       onchange="applyUserBubbleColor(this.value)">
            </div>
            <div class="setting-item">
                <label for="bot-bubble-color">Bubble Color (Bot):</label>
                <input type="color" id="bot-bubble-color" value="rgba(255, 255, 255, 0.1)"
                   onchange="applyBotBubbleColor(this.value)">
            </div>
            <div class="setting-item">
                <label for="font-family">Font Family:</label>
                <select id="font-family" onchange="applyFontFamily(this.value)">
                    <option value="Roboto">Roboto</option>
                    <option value="Arial">Arial</option>
                    <option value="sans-serif">Sans-serif</option>
                    <option value="serif">Serif</option>
                </select>
            </div>
            <div class="setting-item">
                <label for="font-size">Font Size:</label>
                <input type="range" id="font-size" min="12" max="20" value="16" onchange="applyFontSize(this.value)">
            </div>
        </div>
        <div class="settings-section">
            <h3>Bot Customization</h3>
            <div class="setting-item">
                <label for="bot-image">Bot Image:</label>
                <input type="file" id="bot-image" accept="image/*" onchange="applyBotImage(this.files[0])">
            </div>
            <div class="setting-item">
                <label for="bot-name">Bot Name:</label>
                <input type="text" id="bot-name" value="Codi" onchange="applyBotName(this.value)">
            </div>
        </div>
        <div class="settings-section">
            <h3>Layout and Spacing</h3>
            <div class="setting-item">
                <label for="bubble-spacing">Chat Bubble Spacing:</label>
                <input type="range" id="bubble-spacing" min="0" max="20" value="10" onchange="applyBubbleSpacing(this.value)">
            </div>
            <div class="setting-item">
                <label for="sidebar-width">Sidebar Width:</label>
                <input type="range" id="sidebar-width" min="200" max="400" value="300" onchange="applySidebarWidth(this.value)">
            </div>
            <div class="setting-item">
                <label for="content-align">Content Alignment:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="content-align" value="left" onchange="applyContentAlignment(this.value)">
                        Left
                    </label>
                    <label>
                        <input type="radio" name="content-align" value="right" checked
                               onchange="applyContentAlignment(this.value)"> Right
                    </label>
                </div>
            </div>
        </div>
        <div class="settings-section">
            <button onclick="resetToDefaults()">Reset to Defaults</button>
            <div id="preview"><img src="https://i.imgur.com/H7z7a4r.png" alt="Codi preview"/></div>
        </div>
    </div>

    <div class="sidebar-button" id="sidebarToggle">
    <i class="fas fa-cog"></i>
</div>
   <div id="copy-notification">Copied!</div>
     <script src="https://apis.google.com/js/api.js"></script>
<script>
    let apiKey = "";
    const messages = document.getElementById('messages');
    const trainingInput = document.getElementById('training-input');
    const apiModal = document.getElementById('api-modal');
    const apiKeyInput = document.getElementById('api-key-input');
    const secretCode = "21260225";
    const adminApiKey = "AIzaSyB_Dc5gSvnIvhX4PdjSkpBD1mynw_h7syg";
    const userImage = document.getElementById('user-image');
    const profileUploadInput = document.getElementById('profile-upload-input');
    const sidebar = document.getElementById('settingsSidebar');
    const sidebarButton = document.getElementById('sidebarToggle');
     const userGuidePopup = document.getElementById('user-guide-popup');
    const previewImage = document.querySelector('#preview img')
      const copyNotification = document.getElementById('copy-notification');
    let isSidebarOpen = false;
    let botName = "Codi";
    let currentTheme = "dark"; // Default theme
    let messageToEdit = null;
      const prompts = {
         "Data Generation": "You are an expert in academic research and data analysis, tasked with generating high-quality datasets for interdisciplinary research. Your role is to create structured, evidence-based, and domain-specific data tailored to support scholarly investigations. Provide datasets, summaries, or mock data examples with clear methodologies, ensuring relevance and academic rigor. Use a structured format such as tables or JSON where appropriate.",

         "Cody": "You are Cody, a highly skilled academic expert and researcher. Your role is to assist with scholarly writing, critical analysis, and interdisciplinary research while embodying professionalism, clarity, and academic rigor. Respond to questions with in-depth knowledge, evidence-based insights, and structured guidance tailored to the user's needs. Act as an academic mentor, providing step-by-step strategies, writing guidance, and critical evaluations in any discipline.",

         "Code Generation": "You are a code generation assistant, specialized in creating efficient, optimized, and well-documented code for academic and research purposes. Write code in languages such as Python, R, or MATLAB to automate research tasks, analyze datasets, or simulate models. Provide clear explanations of the logic and context for each script, and ensure the code is modular and reusable. Incorporate comments and references to relevant libraries or methods where applicable.",

         "Image Generation": "You are an expert in generating academic or illustrative images to support scholarly work. Produce visuals such as graphs, charts, schematics, or conceptual illustrations tailored to specific research fields. Ensure the visuals are clear, professional, and align with academic publication standards. Provide captions or explanations for each image to clarify its context and relevance.",

        "List Generation": "You are an academic assistant, skilled in creating structured, comprehensive lists to support research and learning. Generate categorized lists such as key concepts, research methodologies, influential scholars, relevant literature, or annotated bibliographies. Ensure the lists are thorough, logically organized, and align with academic standards for clarity and depth.",
          "scrape": "You are a web scraping expert who extracts useful text information from a single webpage. When given a URL, your task is to visit the webpage and extract the text content, excluding HTML tags or elements that don't provide meaning. Only include content that a user would see in their browser. Provide the scraped text as clean, readable HTML content.",
           "crawl": "You are a web crawler and link extraction expert, tasked with identifying and extracting links from a given webpage. When given a URL, you should visit the webpage and identify all hyperlinks, providing the absolute URLs from the HTML. Only provide a list of links."
     };
     const defaultPrompt = `You are Cody, a highly skilled professional assistant specializing in research, writing, critical analysis, and project management. Your role is to provide insightful, detail-oriented, and solution-driven support for freelancers, corporate professionals, and teams across various industries.

                                Your responses should embody professionalism, adaptability, and clarity. Respond to inquiries with precision, well-structured guidance, and a tone that is approachable yet professional. Ensure your language reflects the needs of diverse users, offering actionable insights and suggestions to help them succeed in their goals.

                                Key Attributes of Cody:

                                Proactive Problem-Solving: Anticipate user needs and provide thoughtful, solution-oriented responses to challenges.
                                Versatility: Adapt communication and tone to suit the context, whether writing emails, creating reports, or brainstorming creative ideas.
                                Polished Presentation: Deliver grammatically flawless, concise, and visually appealing responses that meet professional standards.
                                Collaboration: Foster a sense of partnership by tailoring solutions to each user's goals and preferences.
                                When users type 'Hey Cody,' take on the role of a trusted professional mentor, strategist, and problem-solver, helping them achieve their objectives with ease and confidence.
                            `;
     const CLIENT_ID = '112450391570-r8m4v9j8r1t86n6g42b1v587q9n20387.apps.googleusercontent.com';
     const SCOPES = 'https://www.googleapis.com/auth/drive.file';
     let gapiInited = false;

     function clearChat() {
        messages.innerHTML = ''; // Clear all messages
        addMessage(`Hello! I'm Cody, ready to assist you with your tasks!`, false);
    }

    function submitApiKey() {
        const input = apiKeyInput.value.trim();
        if (input === secretCode) {
            apiKey = adminApiKey;
            apiKeyInput.value = adminApiKey;
            apiModal.style.display = 'none';
            alert("Admin API key activated!");
            return;
        }
        if (!input) {
            alert("API key is required!");
            return;
        }

        apiKey = input;
        apiModal.style.display = 'none';
        alert("API key successfully linked!");
    }

    function toggleSidebar() {
         isSidebarOpen = !isSidebarOpen;
            sidebar.classList.toggle('open', isSidebarOpen);
            sidebarButton.classList.toggle('open', isSidebarOpen);
            sidebarButton.style.left = isSidebarOpen ? '320px' : '20px';
    }
    function handleClientLoad(){
      gapi.load('client:auth2', initClient)
    }
    async function initClient(){
       await gapi.client.init({
           clientId: CLIENT_ID,
           scope: SCOPES
       });

      gapiInited = true;
       gapi.client.setApiKey(apiKey);
    }
     handleClientLoad();

    sidebarButton.addEventListener('click', toggleSidebar);
    profileUploadInput.addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                userImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
     function setPrompt(prompt) {
        trainingInput.value = prompt;
     }
    function addMessage(content, isUser, isEdited = false, id = null) {
        const message = document.createElement('div');
        message.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
        if (id) {
            message.setAttribute('data-message-id', id);
        }

        const img = document.createElement('img');
        img.src = isUser ? userImage.src : previewImage.src;
        message.appendChild(img);

        const text = document.createElement('span');
        text.innerHTML = content;  // Use innerHTML to allow HTML rendering
        message.appendChild(text);


        const options = document.createElement('div')
        options.className = 'message-options'
        if (isUser) {
            const editButton = document.createElement('button')
            editButton.innerHTML = '<i class="fas fa-pen"></i>';
            editButton.onclick = () => startEdit(message, content)
            options.appendChild(editButton);
        }
        const copyButton = document.createElement('button')
        copyButton.innerHTML = '<i class="fas fa-copy"></i>';
        copyButton.onclick = () => copyMessage(content)
        options.appendChild(copyButton);
        message.appendChild(options);


        if (isEdited) {
            const editedNote = document.createElement('span');
            editedNote.textContent = " (edited)";
            editedNote.style.fontStyle = 'italic';
            editedNote.style.fontSize = '0.8em';
            text.appendChild(editedNote);
        }
        messages.appendChild(message);
        messages.scrollTop = messages.scrollHeight;
    }

    function copyMessage(text) {
         navigator.clipboard.writeText(text).then(() => {
               copyNotification.classList.add('show');
                setTimeout(() => {
                copyNotification.classList.remove('show');
             }, 2000); // Hide the notification after 2 seconds
        }).catch((err) => {
            console.error("Failed to copy: ", err)
        });
    }

    function startEdit(messageElement, originalContent) {
        messageToEdit = messageElement;
        trainingInput.value = originalContent
        trainingInput.focus();
    }

    function parseBotResponse(text) {
        // Handle bold text (**bold text**)
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

        // Handle italic text (*italic text*)
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');


        //Handle code blocks using ```...```
        text = text.replace(/```([\s\S]*?)```/g, (match, code) => {
            return `<pre><code>${code.trim()}</code></pre>`;
        });
        // Handle lists
       const listRegex = /([-*]|\d+\.)\s+([^\n]+)/g;
        let listMatch;
        let listType = null; // Store the list type
        let newList = '';
        let listOpen = false;

      while ((listMatch = listRegex.exec(text)) !== null) {
            const marker = listMatch[1];
            const listItemText = listMatch[2].trim();
           if (!listOpen){
                 listType =  (marker === '-' || marker === '*') ? 'ul' : 'ol';
                 newList += `<${listType}>`
                 listOpen = true;
            }
          newList += `<li>${listItemText}</li>`

       }

        if (listOpen){
          newList += `</${listType}>`
        }

        text = text.replace(listRegex, '')
       if (newList) {
             text =  newList + text
         }
        //Handle new lines
       text = text.split('\n').filter(Boolean).join('<br>');

        return text;
    }

  async function scrapePage(url){
     try{
          const response = await fetch(url);
           if (!response.ok) {
              throw new Error(`Failed to fetch the webpage ${response.statusText}`)
            }
          const html = await response.text();
           const parser = new DOMParser();
           const doc = parser.parseFromString(html, 'text/html');
           const bodyText = doc.body.textContent;
        return bodyText;
     }catch(error){
       console.error(error);
        return `There was an error when scraping the page: ${error}`
    }
  }
   async function crawlPage(url){
       try{
             const response = await fetch(url);
             if (!response.ok) {
                 throw new Error(`Failed to fetch the webpage ${response.statusText}`)
            }
            const html = await response.text();
           const parser = new DOMParser();
           const doc = parser.parseFromString(html, 'text/html');
           const links = Array.from(doc.querySelectorAll('a')).map(a => a.href);

        return links.filter(Boolean).join('<br>');
       }catch(error){
           console.error(error);
            return `There was an error when crawling the page: ${error}`;
        }
   }


   async function sendTrainingPrompt() {
        const prompt = trainingInput.value.trim();
        const promptType = document.getElementById('prompt-type').value;
        if (!prompt) return;

       let selectedPrompt = prompts[promptType] || defaultPrompt;
        if (messageToEdit) {
            const messageId = messageToEdit.getAttribute('data-message-id');
            const messageTextElement = messageToEdit.querySelector('span');
            if (messageId) {
                addMessage(`[${promptType}] ${prompt}`, true, true, messageId);
                messageToEdit = null
            } else {
                messageTextElement.textContent = `[${promptType}] ${prompt}`;
                const editedNote = document.createElement('span');
                editedNote.textContent = " (edited)";
                editedNote.style.fontStyle = 'italic';
                editedNote.style.fontSize = '0.8em';
                messageTextElement.appendChild(editedNote);
                messageToEdit = null;
            }
            trainingInput.value = '';
            return;
        }
        addMessage(`[${promptType}] ${prompt}`, true);
        trainingInput.value = '';
        const thinking = document.createElement('div');
        thinking.className = 'thinking';
        thinking.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
        messages.appendChild(thinking);
        messages.scrollTop = messages.scrollHeight;
        let responseText;
        try {
            if(promptType === 'scrape')
            {
                 responseText = await scrapePage(prompt)
            } else if(promptType === 'crawl'){
               responseText = await crawlPage(prompt)
           }else{
                 const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({
                         contents: [{
                             parts: [{
                                 text: `${selectedPrompt} [${promptType}] ${prompt}`
                            }]
                         }]
                     })
                });

                 const data = await response.json();
                 thinking.remove();
                 if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0].text) {
                       responseText = data.candidates[0].content.parts[0].text.trim();
                   }else{
                         addMessage(`No response from ${botName}.`, false);
                         return
                   }
           }
           thinking.remove();

          const acknowledgementMatch = responseText.match(/^(.*?)(To establish a strong online presence, here are some valuable tips to help you create compelling social media posts that resonate with your audience:)/s);
            let acknowledgment = "";
           let mainContent = responseText;
             if (acknowledgmentMatch){
                 acknowledgment = parseBotResponse(acknowledgmentMatch[1]);
                 mainContent = responseText.substring(acknowledgmentMatch[0].length);
            }

             addMessage(acknowledgment + parseBotResponse(mainContent), false);

        } catch (error) {
            thinking.remove();
            addMessage("Error connecting to the API or when fetching the page.", false);
        }
    }
  function saveChatToDrive() {
      if (!gapiInited){
        alert("Google API not loaded yet!");
         return;
      }
            gapi.auth2.getAuthInstance().signIn()
              .then(function() {
                   const chatHistory = document.getElementById('messages').innerHTML;
                   const fileMetadata = {
                       'name': `Chat_History_${new Date().toISOString()}.html`,
                        'mimeType': 'text/html'
                    };
                    const fileContent = new Blob([chatHistory], {type: 'text/html'});

                   const form = new FormData();
                   form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
                   form.append('file', fileContent);

                  gapi.client.request({
                     path: '/upload/drive/v3/files',
                       method: 'POST',
                       params: {'uploadType': 'multipart'},
                       body: form
                   }).then(response => {
                       if(response.status === 200){
                            alert("Chat history saved to Google Drive!");
                       }else{
                          alert("Error saving chat to Google Drive!");
                         console.error(response)
                       }
                   }).catch((error) => {
                      alert("Error connecting to Google Drive!");
                    console.error(error);
                   })
              }).catch((error) => {
                  console.error("Error signing in: ", error);
                  alert("Error signing in to Google Drive.")
              })
      }
      function toggleUserGuide(){
          userGuidePopup.classList.toggle('active')
      }

    trainingInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            sendTrainingPrompt();
        }
    });

    function applyTheme(theme) {
        currentTheme = theme;
        if (theme === 'light') {
            document.body.style.setProperty('--bg', '#e8f1f2');
            document.body.style.setProperty('--text-color', '#0b0f14');
        } else if (theme === 'dark') {
            document.body.style.setProperty('--bg', '#0b0f14');
            document.body.style.setProperty('--text-color', '#e8f1f2');
        } else if (theme === 'system') {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.style.setProperty('--bg', '#0b0f14');
                document.body.style.setProperty('--text-color', '#e8f1f2');
            } else {
                document.body.style.setProperty('--bg', '#e8f1f2');
                document.body.style.setProperty('--text-color', '#0b0f14');
            }
        }
    }

    function applyPrimaryColor(color) {
        document.documentElement.style.setProperty('--primary', color);
    }

    function applyAccentColor(color) {
        document.documentElement.style.setProperty('--accent', color);
    }

    function applyBackgroundColor(color) {
        document.body.style.setProperty('--bg', color);
    }

    function applyBubbleStyle(style) {
        const messages = document.querySelectorAll('.message');
        messages.forEach(message => {
            if (style === 'rounded') {
                message.style.borderRadius = '15px';
            } else {
                message.style.borderRadius = '0';
            }
        });
    }

    function applyUserBubbleColor(color) {
        const messages = document.querySelectorAll('.user-message');
        messages.forEach(message => {
            message.style.backgroundColor = color;
        });
    }

    function applyBotBubbleColor(color) {
        const messages = document.querySelectorAll('.bot-message');
        messages.forEach(message => {
            message.style.backgroundColor = color;
        });
    }

    function applyFontFamily(fontFamily) {
        document.body.style.fontFamily = fontFamily;
    }

    function applyFontSize(size) {
        document.body.style.fontSize = `${size}px`;
    }

    function applyBotImage(file) {
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                previewImage.src = e.target.result;
            };
            reader.readAsDataURL(file)
        }
    }

    function applyBotName(name) {
        botName = name;
    }

    function applyBubbleSpacing(spacing) {
        messages.style.gap = `${spacing}px`;
    }

    function applySidebarWidth(width) {
        sidebar.style.width = `${width}px`;
        sidebarButton.style.left = isSidebarOpen ? `${parseInt(width) + 20}px` : '20px';
    }

    function applyContentAlignment(alignment) {
        messages.style.alignItems = alignment === "left" ? "flex-start" : "flex-end";
    }

    function resetToDefaults() {
        document.body.style.setProperty('--primary', '#00ff9d');
        document.body.style.setProperty('--accent', '#ff5722');
        document.body.style.setProperty('--bg', '#0b0f14');
        document.body.style.setProperty('--text-color', '#e8f1f2');
        document.body.style.fontFamily = 'Roboto, sans-serif';
        document.body.style.fontSize = '16px';
        document.querySelector('input[name="theme-mode"][value="dark"]').checked = true;
        document.getElementById('primary-color').value = '#00ff9d';
        document.getElementById('accent-color').value = '#ff5722';
        document.getElementById('background-color').value = '#0b0f14';
        document.querySelector('input[name="bubble-style"][value="rounded"]').checked = true;
        document.getElementById('font-family').value = 'Roboto';
        document.getElementById('font-size').value = '16';
        document.getElementById('bot-name').value = "Codi";
        document.getElementById('bubble-spacing').value = '10';
        document.getElementById('sidebar-width').value = '300';
        document.querySelector('input[name="content-align"][value="right"]').checked = true;
        previewImage.src = 'https://i.imgur.com/H7z7a4r.png';
        messages.style.alignItems = "flex-end";
        applyTheme("dark");
        applyBubbleStyle('rounded');
        applyFontSize(16)
        applyContentAlignment('right')
        messages.style.gap = '10px'
        sidebar.style.width = '300px'
        botName = "Codi"
    }
   // Initialize the bot with a greeting
    clearChat()

</script>
</body>

</html>
